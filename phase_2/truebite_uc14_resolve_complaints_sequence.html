<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueBite - UC-14 Resolve Complaints (Manager) Sequence Diagram</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1350px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }
        h1::before {
            content: "‚öñÔ∏è";
            margin-right: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .info-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .normal-flow {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .error-flow {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .success-flow {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .warning-flow {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        svg {
            width: 100%;
            max-width: 1300px;
            height: auto;
            margin: 20px 0;
        }
        .pseudocode {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        .pseudocode .comment {
            color: #95a5a6;
        }
        .pseudocode .keyword {
            color: #e74c3c;
            font-weight: bold;
        }
        .pseudocode .function {
            color: #3498db;
        }
        .pseudocode .string {
            color: #2ecc71;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ecf0f1;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .user-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .manager { background: #e74c3c; color: white; }
        .customer { background: #2ecc71; color: white; }
        .staff { background: #3498db; color: white; }
        .complaint-card {
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background: #f8f5ff;
        }
        .complaint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .complaint-severity {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .severity-high { background: #f44336; color: white; }
        .severity-medium { background: #ff9800; color: white; }
        .severity-low { background: #4caf50; color: white; }
        .complaint-timeline {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .timeline-item {
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }
        .timeline-item:last-child {
            border-bottom: none;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        .btn-dismiss { background: #9e9e9e; color: white; }
        .btn-refund { background: #4caf50; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .btn-blacklist { background: #f44336; color: white; }
        .btn-investigate { background: #3f51b5; color: white; }
        .evidence-box {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .evidence-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }
        .metrics-box {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            background: #f8f9fa;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .metric-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .reputation-change {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        .rep-positive { background: #4caf50; color: white; }
        .rep-negative { background: #f44336; color: white; }
        .rep-neutral { background: #9e9e9e; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TrueBite - UC-14: Resolve Complaints (Manager)</h1>
        
        <div class="info-box">
            <strong>Use Case:</strong> UC-14 - Manager Complaint Resolution Process<br>
            <strong>Actor:</strong> 
            <span class="user-badge manager">Manager</span><br>
            <strong>Goal:</strong> Review and resolve customer/staff complaints fairly and consistently<br>
            <strong>Preconditions:</strong> Complaints in PENDING status, manager has resolution privileges<br>
            <strong>Postconditions:</strong> Complaints resolved with appropriate actions, reputation/wallet updated, parties notified
        </div>

        <h2>üìä Complaints Dashboard</h2>
        <div class="metrics-box">
            <div class="metric-card">
                <div class="metric-value">8</div>
                <div class="metric-label">Pending Complaints</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">3</div>
                <div class="metric-label">High Priority</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">24h</div>
                <div class="metric-label">Avg Resolution Time</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">87%</div>
                <div class="metric-label">Satisfaction Rate</div>
            </div>
        </div>

        <div class="complaint-card">
            <div class="complaint-header">
                <div>
                    <h3>Complaint #789 - Cold Food Delivery</h3>
                    <p><strong>Order:</strong> #1234 | <strong>Customer:</strong> John Doe (VIP) üåü<br>
                    <strong>Submitted:</strong> 2 hours ago | <strong>Type:</strong> Quality Issue</p>
                </div>
                <div>
                    <span class="complaint-severity severity-high">HIGH PRIORITY</span>
                </div>
            </div>
            
            <div class="complaint-timeline">
                <div class="timeline-item">üìç Order placed: 6:00 PM</div>
                <div class="timeline-item">üë®‚Äçüç≥ Kitchen completed: 6:25 PM</div>
                <div class="timeline-item">üö¥ Picked up: 6:45 PM (20 min delay)</div>
                <div class="timeline-item">üì¶ Delivered: 7:30 PM (45 min delivery)</div>
                <div class="timeline-item">üí¨ Complaint filed: 7:35 PM</div>
            </div>
            
            <div class="evidence-box">
                <h4>Evidence & Context</h4>
                <div class="evidence-item">
                    <span>Customer Rating:</span>
                    <span>‚≠ê 1/5 "Food was cold and soggy"</span>
                </div>
                <div class="evidence-item">
                    <span>Delivery Photo:</span>
                    <span>‚úì Available (shows intact packaging)</span>
                </div>
                <div class="evidence-item">
                    <span>Previous Complaints:</span>
                    <span>0 from customer, 3 about this courier</span>
                </div>
                <div class="evidence-item">
                    <span>Chat Logs:</span>
                    <span>Customer contacted support immediately</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-refund">üí∞ Issue Refund</button>
                <button class="btn btn-warning">‚ö†Ô∏è Warn Courier</button>
                <button class="btn btn-investigate">üîç Request More Info</button>
                <button class="btn btn-dismiss">‚úñ Dismiss</button>
            </div>
        </div>

        <h2>üìä Main Sequence Diagram - Complaint Resolution Flow</h2>
        <svg viewBox="0 0 1300 1900" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="1300" height="1900" fill="#fafafa"/>
            
            <!-- Title -->
            <text x="650" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#2c3e50">
                Manager Complaint Resolution Process - Investigation &amp; Actions
            </text>
            
            <!-- Actors and Objects -->
            <!-- Manager/UI -->
            <rect x="50" y="60" width="100" height="40" fill="#ffebee" stroke="#e74c3c" stroke-width="2" rx="5"/>
            <text x="100" y="85" text-anchor="middle" font-weight="bold">Manager/UI</text>
            <line x1="100" y1="100" x2="100" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- ComplaintController -->
            <rect x="200" y="60" width="140" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
            <text x="270" y="85" text-anchor="middle" font-weight="bold">ComplaintController</text>
            <line x1="270" y1="100" x2="270" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- ComplaintService -->
            <rect x="390" y="60" width="130" height="40" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
            <text x="455" y="85" text-anchor="middle" font-weight="bold">ComplaintService</text>
            <line x1="455" y1="100" x2="455" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- ReputationService -->
            <rect x="570" y="60" width="140" height="40" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5"/>
            <text x="640" y="85" text-anchor="middle" font-weight="bold">ReputationService</text>
            <line x1="640" y1="100" x2="640" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- FinanceService -->
            <rect x="760" y="60" width="120" height="40" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5"/>
            <text x="820" y="85" text-anchor="middle" font-weight="bold">FinanceService</text>
            <line x1="820" y1="100" x2="820" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- NotificationService -->
            <rect x="930" y="60" width="150" height="40" fill="#e0f2f1" stroke="#009688" stroke-width="2" rx="5"/>
            <text x="1005" y="85" text-anchor="middle" font-weight="bold">NotificationService</text>
            <line x1="1005" y1="100" x2="1005" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- Database -->
            <rect x="1130" y="60" width="120" height="40" fill="#fce4ec" stroke="#e91e63" stroke-width="2" rx="5"/>
            <text x="1190" y="85" text-anchor="middle" font-weight="bold">Database/Logs</text>
            <line x1="1190" y1="100" x2="1190" y2="1850" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- PART 1: View Pending Complaints -->
            <rect x="30" y="120" width="1240" height="320" fill="none" stroke="#1976d2" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="140" font-size="14" fill="#1976d2" font-weight="bold">STEP 1: View Pending Complaints Dashboard</text>
            
            <!-- 1. Open Complaints Dashboard -->
            <line x1="100" y1="170" x2="270" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="185" y="165" text-anchor="middle" font-size="12">1: openComplaintsDashboard(managerId)</text>
            
            <!-- 2. Get Pending Complaints -->
            <line x1="270" y1="200" x2="455" y2="200" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="362" y="195" text-anchor="middle" font-size="12">2: getPendingComplaints()</text>
            
            <!-- 3. Query Database -->
            <line x1="455" y1="230" x2="1190" y2="230" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="822" y="225" text-anchor="middle" font-size="11">3: SELECT * FROM complaints</text>
            <text x="822" y="240" text-anchor="middle" font-size="11">WHERE status = 'PENDING' ORDER BY priority DESC</text>
            
            <!-- 4. Get Related Context -->
            <line x1="455" y1="270" x2="1190" y2="270" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="822" y="265" text-anchor="middle" font-size="11">4: getOrderDetails, getChatLogs,</text>
            <text x="822" y="280" text-anchor="middle" font-size="11">getRatings, getPreviousComplaints</text>
            
            <!-- 5. Get User Reputation -->
            <line x1="455" y1="310" x2="640" y2="310" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="547" y="305" text-anchor="middle" font-size="12">5: getUserReputation(userIds)</text>
            
            <!-- 6. Calculate Priority -->
            <rect x="460" y="330" width="120" height="30" fill="#e8f5e9" stroke="#333" rx="3"/>
            <text x="520" y="348" text-anchor="middle" font-size="11">calculatePriority()</text>
            
            <!-- 7. Display Dashboard -->
            <line x1="270" y1="390" x2="100" y2="390" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="185" y="385" text-anchor="middle" font-size="12">7: displayComplaints(sortedList)</text>
            
            <!-- Priority Calculation Note -->
            <rect x="105" y="400" width="160" height="30" fill="#e3f2fd" stroke="#333" rx="3"/>
            <text x="185" y="418" text-anchor="middle" font-size="10">VIP + Severity + Age</text>
            
            <!-- PART 2: Review Complaint Details -->
            <rect x="30" y="460" width="1240" height="320" fill="none" stroke="#9c27b0" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="480" font-size="14" fill="#9c27b0" font-weight="bold">STEP 2: Review Complaint Details</text>
            
            <!-- 8. Select Complaint -->
            <line x1="100" y1="510" x2="270" y2="510" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="185" y="505" text-anchor="middle" font-size="12">8: viewComplaint(complaintId=789)</text>
            
            <!-- 9. Load Full Context -->
            <line x1="270" y1="540" x2="455" y2="540" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="362" y="535" text-anchor="middle" font-size="12">9: getComplaintFullContext(complaintId)</text>
            
            <!-- 10. Get Order History -->
            <line x1="455" y1="570" x2="1190" y2="570" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="822" y="565" text-anchor="middle" font-size="11">10: getOrderTimeline(orderId)</text>
            
            <!-- 11. Get Chat Logs -->
            <line x1="455" y1="600" x2="1190" y2="600" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="822" y="595" text-anchor="middle" font-size="11">11: getChatTranscript(orderId, customerId)</text>
            
            <!-- 12. Get Previous Issues -->
            <line x1="455" y1="630" x2="640" y2="630" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="547" y="625" text-anchor="middle" font-size="12">12: getComplaintHistory(customerId,</text>
            <text x="547" y="640" text-anchor="middle" font-size="11">staffId, deliveryId)</text>
            
            <!-- 13. Analyze Patterns -->
            <rect x="645" y="660" width="130" height="40" fill="#f3e5f5" stroke="#333" rx="3"/>
            <text x="710" y="675" text-anchor="middle" font-size="11">Pattern Analysis:</text>
            <text x="710" y="690" text-anchor="middle" font-size="10">Repeat offender?</text>
            
            <!-- 14. Display Full Context -->
            <line x1="270" y1="730" x2="100" y2="730" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="185" y="725" text-anchor="middle" font-size="12">14: displayComplaintDetails(context)</text>
            
            <!-- Evidence Display -->
            <rect x="105" y="740" width="160" height="30" fill="#f3e5f5" stroke="#333" rx="3"/>
            <text x="185" y="758" text-anchor="middle" font-size="10">Evidence & Timeline</text>
            
            <!-- PART 3: Resolution Actions -->
            <rect x="30" y="800" width="1240" height="620" fill="none" stroke="#4caf50" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="820" font-size="14" fill="#4caf50" font-weight="bold">STEP 3: Resolution Actions (Manager Decision)</text>
            
            <!-- Decision Point -->
            <rect x="105" y="840" width="150" height="30" fill="#e8f5e9" stroke="#4caf50" rx="3"/>
            <text x="180" y="858" text-anchor="middle" font-size="11">Manager chooses action</text>
            
            <!-- ACTION A: Issue Refund -->
            <g transform="translate(30, 890)">
                <rect x="0" y="0" width="300" height="100" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="3"/>
                <text x="150" y="20" text-anchor="middle" font-size="12" font-weight="bold">A: Issue Refund</text>
                
                <line x1="70" y1="40" x2="240" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="155" y="35" text-anchor="middle" font-size="10">15a: issueRefund(complaintId,</text>
                <text x="155" y="50" text-anchor="middle" font-size="10">amount=fullRefund)</text>
                
                <line x1="240" y1="70" x2="425" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="332" y="65" text-anchor="middle" font-size="10">16a: processRefund()</text>
            </g>
            
            <line x1="455" y1="960" x2="820" y2="960" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead-green)"/>
            <text x="637" y="955" text-anchor="middle" font-size="11" fill="#4caf50">17a: creditWallet(customerId, amount)</text>
            
            <!-- ACTION B: Issue Warning -->
            <g transform="translate(350, 890)">
                <rect x="0" y="0" width="300" height="100" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="3"/>
                <text x="150" y="20" text-anchor="middle" font-size="12" font-weight="bold">B: Issue Warning</text>
                
                <line x1="70" y1="40" x2="240" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="155" y="35" text-anchor="middle" font-size="10">15b: issueWarning(complaintId,</text>
                <text x="155" y="50" text-anchor="middle" font-size="10">targetUserId, severity)</text>
                
                <line x1="240" y1="70" x2="425" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="332" y="65" text-anchor="middle" font-size="10">16b: recordWarning()</text>
            </g>
            
            <line x1="455" y1="1030" x2="640" y2="1030" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
            <text x="547" y="1025" text-anchor="middle" font-size="11" fill="#ff9800">17b: updateReputation(userId, -10)</text>
            
            <!-- ACTION C: Dismiss -->
            <g transform="translate(680, 890)">
                <rect x="0" y="0" width="260" height="100" fill="#e0e0e0" stroke="#9e9e9e" stroke-width="2" rx="3"/>
                <text x="130" y="20" text-anchor="middle" font-size="12" font-weight="bold">C: Dismiss</text>
                
                <line x1="70" y1="40" x2="240" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="155" y="35" text-anchor="middle" font-size="10">15c: dismiss(complaintId,</text>
                <text x="155" y="50" text-anchor="middle" font-size="10">reason="No merit")</text>
                
                <text x="130" y="75" text-anchor="middle" font-size="10" fill="#666">No further action</text>
            </g>
            
            <!-- ACTION D: Blacklist -->
            <g transform="translate(970, 890)">
                <rect x="0" y="0" width="270" height="100" fill="#ffebee" stroke="#f44336" stroke-width="2" rx="3"/>
                <text x="135" y="20" text-anchor="middle" font-size="12" font-weight="bold">D: Blacklist User</text>
                
                <line x1="70" y1="40" x2="240" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="155" y="35" text-anchor="middle" font-size="10">15d: blacklistUser(userId,</text>
                <text x="155" y="50" text-anchor="middle" font-size="10">reason, duration)</text>
                
                <text x="135" y="75" text-anchor="middle" font-size="10" fill="#f44336">Severe action</text>
            </g>
            
            <line x1="455" y1="1100" x2="640" y2="1100" stroke="#f44336" stroke-width="2" marker-end="url(#arrowhead-red)"/>
            <text x="547" y="1095" text-anchor="middle" font-size="11" fill="#f44336">17d: blacklistUser(userId)</text>
            
            <!-- 18. Update Complaint Status -->
            <line x1="455" y1="1150" x2="1190" y2="1150" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="822" y="1145" text-anchor="middle" font-size="11">18: UPDATE complaints SET status = 'RESOLVED',</text>
            <text x="822" y="1160" text-anchor="middle" font-size="11">resolution_action = ?, resolved_by = ?, resolved_at = NOW()</text>
            
            <!-- 19. Create Resolution Log -->
            <rect x="460" y="1180" width="140" height="40" fill="#e8f5e9" stroke="#333" rx="3"/>
            <text x="530" y="1195" text-anchor="middle" font-size="11">Create Resolution Log:</text>
            <text x="530" y="1210" text-anchor="middle" font-size="10">Action, Reason, Evidence</text>
            
            <!-- 20. Calculate Compensation -->
            <line x1="455" y1="1240" x2="820" y2="1240" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="637" y="1235" text-anchor="middle" font-size="12">20: calculateCompensation(complaint)</text>
            
            <!-- Compensation Formula -->
            <rect x="825" y="1250" width="150" height="40" fill="#fff3e0" stroke="#333" rx="3"/>
            <text x="900" y="1265" text-anchor="middle" font-size="10">Base + VIP bonus +</text>
            <text x="900" y="1280" text-anchor="middle" font-size="10">Severity multiplier</text>
            
            <!-- 21. Send Notifications -->
            <line x1="455" y1="1310" x2="1005" y2="1310" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="730" y="1305" text-anchor="middle" font-size="12">21: notifyResolution(allParties)</text>
            
            <!-- 22. Update Metrics -->
            <rect x="275" y="1340" width="140" height="30" fill="#e3f2fd" stroke="#333" rx="3"/>
            <text x="345" y="1358" text-anchor="middle" font-size="11">updateMetrics()</text>
            
            <!-- 23. Success Response -->
            <line x1="270" y1="1390" x2="100" y2="1390" stroke="#4caf50" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-green)"/>
            <text x="185" y="1385" text-anchor="middle" font-size="12" fill="#4caf50">23: "Complaint resolved"</text>
            
            <!-- PART 4: Exception - Missing Context -->
            <rect x="30" y="1440" width="1240" height="380" fill="none" stroke="#f44336" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="1460" font-size="14" fill="#f44336" font-weight="bold">EXCEPTION: Missing Context or Information</text>
            
            <!-- E1. Missing Order Data -->
            <rect x="105" y="1490" width="180" height="30" fill="#ffebee" stroke="#f44336" rx="3"/>
            <text x="195" y="1508" text-anchor="middle" font-size="11">Order deleted/missing</text>
            
            <!-- E2. Request More Info -->
            <line x1="100" y1="1540" x2="270" y2="1540" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="185" y="1535" text-anchor="middle" font-size="12">E2: requestMoreInfo(complaintId)</text>
            
            <!-- E3. Mark as Pending Investigation -->
            <line x1="270" y1="1570" x2="455" y2="1570" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="362" y="1565" text-anchor="middle" font-size="12">E3: markPendingInvestigation()</text>
            
            <!-- E4. Update Status -->
            <line x1="455" y1="1600" x2="1190" y2="1600" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="822" y="1595" text-anchor="middle" font-size="11">E4: UPDATE complaints SET status = 'INVESTIGATING',</text>
            <text x="822" y="1610" text-anchor="middle" font-size="11">needs_info = true</text>
            
            <!-- E5. Contact Involved Parties -->
            <line x1="455" y1="1640" x2="1005" y2="1640" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="730" y="1635" text-anchor="middle" font-size="12">E5: requestInfoFromParties()</text>
            
            <!-- E6. Schedule Follow-up -->
            <rect x="460" y="1670" width="150" height="30" fill="#ffebee" stroke="#333" rx="3"/>
            <text x="535" y="1688" text-anchor="middle" font-size="11">scheduleFollowUp(24h)</text>
            
            <!-- Alternative: Cancel if Unresolvable -->
            <g transform="translate(700, 1490)">
                <rect x="0" y="0" width="500" height="120" fill="#ffebee" stroke="#f44336" rx="3"/>
                <text x="250" y="20" text-anchor="middle" font-size="12" font-weight="bold">Alternative: Cancel Complaint</text>
                <text x="250" y="40" text-anchor="middle" font-size="10">‚Ä¢ Data corruption/loss</text>
                <text x="250" y="55" text-anchor="middle" font-size="10">‚Ä¢ Unable to verify claims</text>
                <text x="250" y="70" text-anchor="middle" font-size="10">‚Ä¢ Mark as CANCELLED</text>
                <text x="250" y="85" text-anchor="middle" font-size="10">‚Ä¢ Issue courtesy credit if customer affected</text>
                <text x="250" y="100" text-anchor="middle" font-size="10">‚Ä¢ Log system issue for tech team</text>
            </g>
            
            <!-- E7. Set Timeout -->
            <line x1="455" y1="1740" x2="1190" y2="1740" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
            <text x="822" y="1735" text-anchor="middle" font-size="11" fill="#ff9800">E7: setInvestigationTimeout(72h)</text>
            
            <!-- E8. Auto-resolve if No Response -->
            <rect x="1010" y="1760" width="180" height="40" fill="#fff3e0" stroke="#ff9800" rx="3"/>
            <text x="1100" y="1775" text-anchor="middle" font-size="10">After timeout:</text>
            <text x="1100" y="1790" text-anchor="middle" font-size="10">Auto-resolve or escalate</text>
            
            <!-- Arrow definitions -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#333"/>
                </marker>
                <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#4caf50"/>
                </marker>
                <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#ff9800"/>
                </marker>
                <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#f44336"/>
                </marker>
            </defs>
        </svg>

        <h2>üíª Detailed Pseudocode Implementation</h2>
        <div class="pseudocode">
<span class="comment">// TrueBite Complaint Resolution System - UC-14</span>

<span class="keyword">CLASS</span> <span class="function">ComplaintService</span>:
    
    <span class="keyword">FUNCTION</span> viewPendingComplaints(managerId: String):
        <span class="comment">// Verify manager authorization</span>
        manager = UserRepository.findById(managerId)
        
        <span class="keyword">IF</span> manager == null OR manager.role != <span class="string">"MANAGER"</span>:
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Unauthorized access"</span>)
        
        <span class="comment">// Get all pending complaints</span>
        complaints = ComplaintRepository.findByStatus([<span class="string">"PENDING"</span>, <span class="string">"INVESTIGATING"</span>])
        
        <span class="comment">// Enrich each complaint with context</span>
        enrichedComplaints = []
        
        <span class="keyword">FOR EACH</span> complaint <span class="keyword">IN</span> complaints:
            enriched = new EnrichedComplaint()
            enriched.complaint = complaint
            
            <span class="comment">// Get order details</span>
            enriched.order = OrderRepository.findById(complaint.orderId)
            
            <span class="comment">// Get user information</span>
            enriched.customer = UserRepository.findById(complaint.customerId)
            enriched.customerReputation = ReputationService.getReputation(complaint.customerId)
            
            <span class="keyword">IF</span> complaint.staffId != null:
                enriched.staff = UserRepository.findById(complaint.staffId)
                enriched.staffReputation = ReputationService.getReputation(complaint.staffId)
            
            <span class="keyword">IF</span> complaint.deliveryId != null:
                enriched.delivery = UserRepository.findById(complaint.deliveryId)
                enriched.deliveryReputation = ReputationService.getReputation(complaint.deliveryId)
            
            <span class="comment">// Get historical data</span>
            enriched.previousComplaints = getComplaintHistory(
                customerId: complaint.customerId,
                staffId: complaint.staffId,
                deliveryId: complaint.deliveryId
            )
            
            <span class="comment">// Get chat logs</span>
            enriched.chatLogs = ChatRepository.findByOrderId(complaint.orderId)
            
            <span class="comment">// Get ratings</span>
            enriched.ratings = RatingRepository.findByOrderId(complaint.orderId)
            
            <span class="comment">// Calculate priority</span>
            enriched.priority = calculateComplaintPriority(enriched)
            
            enrichedComplaints.add(enriched)
        
        <span class="comment">// Sort by priority</span>
        enrichedComplaints.sort((a, b) -> b.priority.compareTo(a.priority))
        
        <span class="comment">// Calculate dashboard metrics</span>
        metrics = new ComplaintMetrics()
        metrics.totalPending = complaints.size()
        metrics.highPriority = enrichedComplaints.filter(c -> c.priority >= 8).count()
        metrics.averageResolutionTime = calculateAverageResolutionTime()
        metrics.satisfactionRate = calculateSatisfactionRate()
        
        <span class="keyword">RETURN</span> Result(
            success: true,
            complaints: enrichedComplaints,
            metrics: metrics
        )
    
    <span class="keyword">FUNCTION</span> resolveComplaint(complaintId: String, managerId: String, resolution: ResolutionData):
        <span class="keyword">INPUT</span>: {
            complaintId: String,
            managerId: String,
            resolution: {
                action: String, <span class="comment">// DISMISS, WARNING, REFUND, BLACKLIST, INVESTIGATE</span>
                targetUserId: String (optional),
                refundAmount: Decimal (optional),
                refundType: String (optional), <span class="comment">// FULL, PARTIAL, CREDIT</span>
                warningLevel: String (optional), <span class="comment">// MINOR, MAJOR, FINAL</span>
                blacklistDuration: Integer (optional), <span class="comment">// days</span>
                reason: String,
                notes: String,
                evidence: String[]
            }
        }
        
        <span class="comment">// Step 1: Validate complaint and manager</span>
        complaint = ComplaintRepository.findById(complaintId)
        
        <span class="keyword">IF</span> complaint == null:
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Complaint not found"</span>)
        
        <span class="keyword">IF</span> complaint.status == <span class="string">"RESOLVED"</span>:
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Complaint already resolved"</span>)
        
        manager = UserRepository.findById(managerId)
        
        <span class="keyword">IF NOT</span> hasResolutionPrivileges(manager):
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Insufficient privileges"</span>)
        
        <span class="comment">// Step 2: Execute resolution action</span>
        <span class="keyword">BEGIN TRANSACTION</span>:
            actionResult = null
            
            <span class="keyword">SWITCH</span> resolution.action:
                <span class="keyword">CASE</span> <span class="string">"DISMISS"</span>:
                    actionResult = dismissComplaint(complaint, resolution)
                
                <span class="keyword">CASE</span> <span class="string">"WARNING"</span>:
                    actionResult = issueWarning(complaint, resolution)
                
                <span class="keyword">CASE</span> <span class="string">"REFUND"</span>:
                    actionResult = processRefund(complaint, resolution)
                
                <span class="keyword">CASE</span> <span class="string">"BLACKLIST"</span>:
                    actionResult = blacklistUser(complaint, resolution)
                
                <span class="keyword">CASE</span> <span class="string">"INVESTIGATE"</span>:
                    actionResult = markForInvestigation(complaint, resolution)
                
                <span class="keyword">DEFAULT</span>:
                    <span class="keyword">THROW</span> InvalidActionException(resolution.action)
            
            <span class="comment">// Step 3: Update complaint status</span>
            <span class="keyword">IF</span> resolution.action != <span class="string">"INVESTIGATE"</span>:
                complaint.status = <span class="string">"RESOLVED"</span>
                complaint.resolution = resolution.action
            <span class="keyword">ELSE</span>:
                complaint.status = <span class="string">"INVESTIGATING"</span>
                complaint.investigationStarted = now()
            
            complaint.resolvedBy = managerId
            complaint.resolvedAt = now()
            complaint.resolutionReason = resolution.reason
            complaint.resolutionNotes = resolution.notes
            
            ComplaintRepository.update(complaint)
            
            <span class="comment">// Step 4: Create resolution log</span>
            resolutionLog = new ResolutionLog()
            resolutionLog.complaintId = complaintId
            resolutionLog.managerId = managerId
            resolutionLog.action = resolution.action
            resolutionLog.actionDetails = actionResult
            resolutionLog.timestamp = now()
            resolutionLog.evidence = resolution.evidence
            
            ResolutionLogRepository.save(resolutionLog)
            
        <span class="keyword">COMMIT TRANSACTION</span>
        
        <span class="comment">// Step 5: Send notifications</span>
        notifyComplaintResolution(complaint, resolution, actionResult)
        
        <span class="comment">// Step 6: Update metrics</span>
        updateComplaintMetrics(complaint, resolution)
        
        <span class="keyword">RETURN</span> Result(
            success: true,
            message: <span class="string">"Complaint resolved successfully"</span>,
            complaintId: complaintId,
            action: resolution.action,
            actionResult: actionResult
        )
    
    <span class="keyword">FUNCTION</span> dismissComplaint(complaint: Complaint, resolution: ResolutionData):
        <span class="comment">// No action needed - just mark as resolved</span>
        
        <span class="comment">// Log dismissal</span>
        log.info(<span class="string">"Complaint "</span> + complaint.complaintId + 
                <span class="string">" dismissed by manager. Reason: "</span> + resolution.reason)
        
        <span class="comment">// Update customer reputation if frivolous</span>
        <span class="keyword">IF</span> resolution.reason.contains(<span class="string">"frivolous"</span>) OR 
           resolution.reason.contains(<span class="string">"false"</span>):
            ReputationService.updateReputation(
                userId: complaint.customerId,
                change: -5,
                reason: <span class="string">"Frivolous complaint"</span>
            )
        
        <span class="keyword">RETURN</span> ActionResult(
            type: <span class="string">"DISMISS"</span>,
            details: <span class="string">"Complaint dismissed with no action"</span>
        )
    
    <span class="keyword">FUNCTION</span> issueWarning(complaint: Complaint, resolution: ResolutionData):
        targetUserId = resolution.targetUserId ?? determineTargetUser(complaint)
        
        <span class="comment">// Create warning record</span>
        warning = new UserWarning()
        warning.userId = targetUserId
        warning.complaintId = complaint.complaintId
        warning.level = resolution.warningLevel ?? <span class="string">"MINOR"</span>
        warning.reason = resolution.reason
        warning.issuedBy = resolution.managerId
        warning.issuedAt = now()
        
        WarningRepository.save(warning)
        
        <span class="comment">// Update reputation</span>
        reputationChange = 0
        <span class="keyword">SWITCH</span> warning.level:
            <span class="keyword">CASE</span> <span class="string">"MINOR"</span>: reputationChange = -10
            <span class="keyword">CASE</span> <span class="string">"MAJOR"</span>: reputationChange = -25
            <span class="keyword">CASE</span> <span class="string">"FINAL"</span>: reputationChange = -50
        
        ReputationService.updateReputation(
            userId: targetUserId,
            change: reputationChange,
            reason: <span class="string">"Warning: "</span> + resolution.reason
        )
        
        <span class="comment">// Check for escalation</span>
        warningCount = WarningRepository.countByUserInPeriod(
            targetUserId, 
            now() - 30.days
        )
        
        <span class="keyword">IF</span> warningCount >= 3:
            <span class="comment">// Auto-escalate to suspension</span>
            suspendUser(targetUserId, 7) <span class="comment">// 7 days</span>
        
        <span class="keyword">RETURN</span> ActionResult(
            type: <span class="string">"WARNING"</span>,
            targetUser: targetUserId,
            level: warning.level,
            reputationImpact: reputationChange,
            totalWarnings: warningCount
        )
    
    <span class="keyword">FUNCTION</span> processRefund(complaint: Complaint, resolution: ResolutionData):
        order = OrderRepository.findById(complaint.orderId)
        
        <span class="keyword">IF</span> order == null:
            <span class="keyword">THROW</span> OrderNotFoundException(complaint.orderId)
        
        <span class="comment">// Calculate refund amount</span>
        refundAmount = 0
        
        <span class="keyword">IF</span> resolution.refundType == <span class="string">"FULL"</span>:
            refundAmount = order.totalAmount
        <span class="keyword">ELSE IF</span> resolution.refundType == <span class="string">"PARTIAL"</span>:
            refundAmount = resolution.refundAmount ?? order.subtotal
        <span class="keyword">ELSE IF</span> resolution.refundType == <span class="string">"CREDIT"</span>:
            refundAmount = resolution.refundAmount ?? calculateCompensation(complaint)
        
        <span class="comment">// Process refund through finance service</span>
        refundResult = FinanceService.processRefund(
            customerId: complaint.customerId,
            orderId: complaint.orderId,
            amount: refundAmount,
            type: resolution.refundType,
            reason: resolution.reason
        )
        
        <span class="comment">// Update order status if full refund</span>
        <span class="keyword">IF</span> resolution.refundType == <span class="string">"FULL"</span>:
            order.status = <span class="string">"REFUNDED"</span>
            OrderRepository.update(order)
        
        <span class="comment">// Positive reputation for valid complaint</span>
        ReputationService.updateReputation(
            userId: complaint.customerId,
            change: 5,
            reason: <span class="string">"Valid complaint resolved"</span>
        )
        
        <span class="keyword">RETURN</span> ActionResult(
            type: <span class="string">"REFUND"</span>,
            refundAmount: refundAmount,
            refundType: resolution.refundType,
            transactionId: refundResult.transactionId
        )
    
    <span class="keyword">FUNCTION</span> blacklistUser(complaint: Complaint, resolution: ResolutionData):
        targetUserId = resolution.targetUserId ?? determineTargetUser(complaint)
        
        <span class="comment">// Check if already blacklisted</span>
        existingBlacklist = BlacklistRepository.findActiveByUser(targetUserId)
        
        <span class="keyword">IF</span> existingBlacklist != null:
            <span class="comment">// Extend blacklist</span>
            existingBlacklist.endDate = existingBlacklist.endDate + resolution.blacklistDuration.days
            BlacklistRepository.update(existingBlacklist)
        <span class="keyword">ELSE</span>:
            <span class="comment">// Create new blacklist entry</span>
            blacklist = new Blacklist()
            blacklist.userId = targetUserId
            blacklist.reason = resolution.reason
            blacklist.complaintId = complaint.complaintId
            blacklist.startDate = now()
            blacklist.endDate = now() + resolution.blacklistDuration.days
            blacklist.createdBy = resolution.managerId
            
            BlacklistRepository.save(blacklist)
        
        <span class="comment">// Deactivate user account</span>
        user = UserRepository.findById(targetUserId)
        user.status = <span class="string">"BLACKLISTED"</span>
        user.blacklistReason = resolution.reason
        UserRepository.update(user)
        
        <span class="comment">// Cancel any active orders</span>
        activeOrders = OrderRepository.findActiveByUser(targetUserId)
        
        <span class="keyword">FOR EACH</span> order <span class="keyword">IN</span> activeOrders:
            cancelOrder(order, <span class="string">"User blacklisted"</span>)
        
        <span class="comment">// Zero out reputation</span>
        ReputationService.setReputation(targetUserId, 0)
        
        <span class="keyword">RETURN</span> ActionResult(
            type: <span class="string">"BLACKLIST"</span>,
            targetUser: targetUserId,
            duration: resolution.blacklistDuration,
            endDate: blacklist.endDate,
            cancelledOrders: activeOrders.size()
        )

<span class="comment">// Helper Functions</span>
<span class="keyword">FUNCTION</span> calculateComplaintPriority(enriched: EnrichedComplaint):
    priority = 0
    
    <span class="comment">// Base severity</span>
    <span class="keyword">SWITCH</span> enriched.complaint.severity:
        <span class="keyword">CASE</span> <span class="string">"HIGH"</span>: priority += 5
        <span class="keyword">CASE</span> <span class="string">"MEDIUM"</span>: priority += 3
        <span class="keyword">CASE</span> <span class="string">"LOW"</span>: priority += 1
    
    <span class="comment">// VIP customer boost</span>
    <span class="keyword">IF</span> enriched.customer.isVIP:
        priority += 3
    
    <span class="comment">// Age of complaint</span>
    hoursSinceSubmission = (now() - enriched.complaint.submittedAt).hours
    <span class="keyword">IF</span> hoursSinceSubmission > 24:
        priority += 2
    <span class="keyword">IF</span> hoursSinceSubmission > 48:
        priority += 2
    
    <span class="comment">// Repeat offender</span>
    <span class="keyword">IF</span> enriched.previousComplaints.aboutStaff > 2:
        priority += 2
    <span class="keyword">IF</span> enriched.previousComplaints.aboutDelivery > 2:
        priority += 2
    
    <span class="comment">// Financial impact</span>
    <span class="keyword">IF</span> enriched.order?.totalAmount > 100:
        priority += 1
    
    <span class="keyword">RETURN</span> min(10, priority)

<span class="keyword">FUNCTION</span> calculateCompensation(complaint: Complaint):
    order = OrderRepository.findById(complaint.orderId)
    baseCompensation = order.subtotal * 0.2  <span class="comment">// 20% base</span>
    
    <span class="comment">// Severity multiplier</span>
    <span class="keyword">SWITCH</span> complaint.severity:
        <span class="keyword">CASE</span> <span class="string">"HIGH"</span>: baseCompensation *= 2.0
        <span class="keyword">CASE</span> <span class="string">"MEDIUM"</span>: baseCompensation *= 1.5
        <span class="keyword">CASE</span> <span class="string">"LOW"</span>: baseCompensation *= 1.0
    
    <span class="comment">// VIP bonus</span>
    customer = UserRepository.findById(complaint.customerId)
    <span class="keyword">IF</span> customer.isVIP:
        baseCompensation += 10  <span class="comment">// Fixed VIP bonus</span>
    
    <span class="comment">// Cap at order total</span>
    <span class="keyword">RETURN</span> min(baseCompensation, order.totalAmount)

<span class="keyword">FUNCTION</span> notifyComplaintResolution(complaint: Complaint, resolution: ResolutionData, actionResult: ActionResult):
    <span class="comment">// Notify customer</span>
    NotificationService.notifyUser(
        userId: complaint.customerId,
        type: <span class="string">"COMPLAINT_RESOLVED"</span>,
        message: buildCustomerMessage(complaint, resolution, actionResult),
        complaintId: complaint.complaintId
    )
    
    <span class="comment">// Notify affected staff/delivery if applicable</span>
    <span class="keyword">IF</span> resolution.action == <span class="string">"WARNING"</span> OR resolution.action == <span class="string">"BLACKLIST"</span>:
        <span class="keyword">IF</span> complaint.staffId != null:
            NotificationService.notifyUser(
                userId: complaint.staffId,
                type: <span class="string">"COMPLAINT_ACTION"</span>,
                message: buildStaffMessage(resolution, actionResult),
                severity: resolution.warningLevel
            )
        
        <span class="keyword">IF</span> complaint.deliveryId != null:
            NotificationService.notifyUser(
                userId: complaint.deliveryId,
                type: <span class="string">"COMPLAINT_ACTION"</span>,
                message: buildDeliveryMessage(resolution, actionResult),
                severity: resolution.warningLevel
            )
    
    <span class="comment">// Notify other managers for severe actions</span>
    <span class="keyword">IF</span> resolution.action == <span class="string">"BLACKLIST"</span>:
        NotificationService.notifyManagers(
            <span class="string">"User blacklisted"</span>,
            actionResult
        )

<span class="keyword">FUNCTION</span> markForInvestigation(complaint: Complaint, resolution: ResolutionData):
    <span class="comment">// Create investigation task</span>
    investigation = new Investigation()
    investigation.complaintId = complaint.complaintId
    investigation.reason = resolution.reason
    investigation.requestedInfo = resolution.notes
    investigation.assignedTo = resolution.managerId
    investigation.createdAt = now()
    investigation.deadline = now() + 72.hours
    
    InvestigationRepository.save(investigation)
    
    <span class="comment">// Contact parties for information</span>
    parties = [complaint.customerId, complaint.staffId, complaint.deliveryId].filter(id -> id != null)
    
    <span class="keyword">FOR EACH</span> partyId <span class="keyword">IN</span> parties:
        NotificationService.requestInformation(
            userId: partyId,
            complaintId: complaint.complaintId,
            requestedInfo: resolution.notes,
            deadline: investigation.deadline
        )
    
    <span class="comment">// Schedule follow-up</span>
    SchedulerService.schedule(
        taskId: <span class="string">"INVESTIGATION_"</span> + complaint.complaintId,
        runAt: investigation.deadline,
        action: () -> checkInvestigationStatus(complaint.complaintId)
    )
    
    <span class="keyword">RETURN</span> ActionResult(
        type: <span class="string">"INVESTIGATE"</span>,
        investigationId: investigation.id,
        deadline: investigation.deadline,
        partiesContacted: parties.size()
    )

<span class="keyword">CLASS</span> <span class="function">ComplaintAnalytics</span>:
    
    <span class="keyword">FUNCTION</span> analyzeComplaintPatterns():
        <span class="comment">// Run weekly to identify problem areas</span>
        
        recentComplaints = ComplaintRepository.findByDateRange(
            now() - 7.days,
            now()
        )
        
        <span class="comment">// Identify repeat offenders</span>
        staffComplaints = groupByStaff(recentComplaints)
        <span class="keyword">FOR EACH</span> (staffId, complaints) <span class="keyword">IN</span> staffComplaints:
            <span class="keyword">IF</span> complaints.size() >= 3:
                flagForReview(staffId, <span class="string">"Multiple complaints"</span>)
        
        <span class="comment">// Identify systemic issues</span>
        typeFrequency = groupByType(recentComplaints)
        <span class="keyword">FOR EACH</span> (type, count) <span class="keyword">IN</span> typeFrequency:
            <span class="keyword">IF</span> count > averageCount * 2:
                createSystemicIssueAlert(type, count)
        
        <span class="comment">// VIP complaint trends</span>
        vipComplaints = recentComplaints.filter(c -> c.customer.isVIP)
        <span class="keyword">IF</span> vipComplaints.size() > vipThreshold:
            escalateToSeniorManagement(vipComplaints)
</div>

        <h2>üìã Resolution Actions Summary</h2>
        <table>
            <tr>
                <th>Action</th>
                <th>When to Use</th>
                <th>Impact</th>
                <th>Follow-up</th>
            </tr>
            <tr>
                <td><strong>Dismiss</strong></td>
                <td>No merit, false claim, misunderstanding</td>
                <td>No action taken<br><span class="reputation-change rep-neutral">Rep: 0</span></td>
                <td>Customer notified with reason</td>
            </tr>
            <tr>
                <td><strong>Warning</strong></td>
                <td>Minor violation, first offense</td>
                <td>Warning recorded<br><span class="reputation-change rep-negative">Rep: -10 to -50</span></td>
                <td>Staff notified, training if needed</td>
            </tr>
            <tr>
                <td><strong>Refund</strong></td>
                <td>Service failure, quality issue</td>
                <td>Full/partial refund<br><span class="reputation-change rep-positive">Customer Rep: +5</span></td>
                <td>Finance processes, customer credited</td>
            </tr>
            <tr>
                <td><strong>Blacklist</strong></td>
                <td>Severe violation, repeat offender</td>
                <td>Account suspended<br><span class="reputation-change rep-negative">Rep: 0</span></td>
                <td>Active orders cancelled, ban enforced</td>
            </tr>
            <tr>
                <td><strong>Investigate</strong></td>
                <td>Missing info, complex issue</td>
                <td>Status: INVESTIGATING</td>
                <td>Parties contacted, 72h deadline</td>
            </tr>
        </table>

        <h2>üéØ Complaint Priority Formula</h2>
        <div class="info-box">
            <strong>Priority Score (0-10):</strong><br>
            ‚Ä¢ Severity: HIGH (+5), MEDIUM (+3), LOW (+1)<br>
            ‚Ä¢ VIP Customer: +3 points<br>
            ‚Ä¢ Age > 24h: +2 points<br>
            ‚Ä¢ Age > 48h: +2 additional points<br>
            ‚Ä¢ Repeat offender (>2 complaints): +2 points<br>
            ‚Ä¢ High order value (>$100): +1 point<br><br>
            
            <strong>Auto-Escalation Triggers:</strong><br>
            ‚Ä¢ 3+ warnings in 30 days ‚Üí Auto-suspend<br>
            ‚Ä¢ 5+ complaints about same staff ‚Üí Management review<br>
            ‚Ä¢ VIP complaint unresolved > 24h ‚Üí Senior escalation
        </div>

        <h2>üß™ Test Scenarios</h2>
        <div class="success-flow">
            <strong>Test 1: Valid Quality Complaint - Refund</strong><br>
            ‚Ä¢ Customer complains about cold food<br>
            ‚Ä¢ Evidence: Low rating, late delivery time<br>
            ‚Ä¢ Manager issues full refund<br>
            ‚Ä¢ Customer wallet credited<br>
            ‚Ä¢ Delivery person warned<br>
            ‚Ä¢ Customer reputation +5
        </div>

        <div class="warning-flow">
            <strong>Test 2: Staff Behavior - Warning</strong><br>
            ‚Ä¢ Rude behavior complaint<br>
            ‚Ä¢ First offense for staff member<br>
            ‚Ä¢ Manager issues MINOR warning<br>
            ‚Ä¢ Staff reputation -10<br>
            ‚Ä¢ Warning logged in system<br>
            ‚Ä¢ Training recommended
        </div>

        <div class="error-flow">
            <strong>Test 3: Repeat Offender - Blacklist</strong><br>
            ‚Ä¢ Customer with multiple false complaints<br>
            ‚Ä¢ Pattern of abuse detected<br>
            ‚Ä¢ Manager blacklists for 30 days<br>
            ‚Ä¢ Account suspended immediately<br>
            ‚Ä¢ Active orders cancelled<br>
            ‚Ä¢ Reputation set to 0
        </div>

        <div class="normal-flow">
            <strong>Test 4: Missing Context - Investigation</strong><br>
            ‚Ä¢ Order data corrupted/missing<br>
            ‚Ä¢ Manager requests more info<br>
            ‚Ä¢ Status ‚Üí INVESTIGATING<br>
            ‚Ä¢ Parties contacted for details<br>
            ‚Ä¢ 72-hour deadline set<br>
            ‚Ä¢ Auto-resolve if no response
        </div>
    </div>
</body>
</html>
