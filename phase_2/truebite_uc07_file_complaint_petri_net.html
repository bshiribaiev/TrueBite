<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueBite - UC-07 File Complaint (Petri Net)</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #ee5a6f 0%, #f29263 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #ee5a6f;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }
        h1::before {
            content: "‚ö†Ô∏è";
            margin-right: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .info-box {
            background: linear-gradient(135deg, #ee5a6f15 0%, #f2926315 100%);
            border-left: 4px solid #ee5a6f;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .normal-flow {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .error-flow {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .warning-flow {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        svg {
            width: 100%;
            max-width: 1350px;
            height: auto;
            margin: 20px 0;
        }
        .pseudocode {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        .pseudocode .comment {
            color: #95a5a6;
        }
        .pseudocode .keyword {
            color: #e74c3c;
            font-weight: bold;
        }
        .pseudocode .function {
            color: #3498db;
        }
        .pseudocode .string {
            color: #2ecc71;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th {
            background: #ee5a6f;
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ecf0f1;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .user-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .customer { background: #3498db; color: white; }
        .vip { background: #f39c12; color: white; }
        .manager { background: #2ecc71; color: white; }
        .petri-legend {
            background: #f8f9fa;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 15px;
        }
        .legend-item svg {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        .complaint-form {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background: #fafafa;
        }
        .complaint-form h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .priority-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        .priority-high { background: #f44336; color: white; }
        .priority-normal { background: #2196f3; color: white; }
        .priority-low { background: #9e9e9e; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TrueBite - UC-07: File Complaint (Petri Net)</h1>
        
        <div class="info-box">
            <strong>Use Case:</strong> UC-07 - File Complaint with Validation & Manager Assignment<br>
            <strong>Actors:</strong> 
            <span class="user-badge customer">Customer</span>
            <span class="user-badge vip">VIP Customer</span>
            <span class="user-badge manager">Manager</span><br>
            <strong>Goal:</strong> Allow customers to file complaints with validation and abuse prevention<br>
            <strong>Preconditions:</strong> User has completed order, authenticated<br>
            <strong>Postconditions:</strong> Valid complaint queued for manager review, or warning issued for abuse
        </div>

        <h2>üìù Complaint Form Interface</h2>
        <div class="complaint-form">
            <h3>File a Complaint - Order #1234</h3>
            <div class="form-group">
                <label>Complaint Type:</label>
                <select>
                    <option>Select Type...</option>
                    <option>Chef - Food Quality</option>
                    <option>Delivery - Late/Cold</option>
                    <option>Delivery - Wrong Order</option>
                    <option>System - Payment Issue</option>
                    <option>System - App Problem</option>
                    <option>Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea rows="4" placeholder="Please describe your issue in detail...">The food arrived cold and the delivery person was 30 minutes late without any notification.</textarea>
            </div>
            <div class="form-group">
                <label>Evidence (Optional):</label>
                <button style="padding: 8px 15px;">üì∑ Upload Photo</button>
            </div>
        </div>

        <h2>üîÑ Petri Net Legend</h2>
        <div class="petri-legend">
            <div class="legend-item">
                <svg viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="15" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
                </svg>
                <span><strong>Place:</strong> State/Condition</span>
            </div>
            <div class="legend-item">
                <svg viewBox="0 0 40 40">
                    <rect x="15" y="5" width="10" height="30" fill="#333" stroke="#000" stroke-width="1"/>
                </svg>
                <span><strong>Transition:</strong> Action/Event</span>
            </div>
            <div class="legend-item">
                <svg viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="5" fill="#ee5a6f"/>
                </svg>
                <span><strong>Token:</strong> Complaint</span>
            </div>
            <div class="legend-item">
                <svg viewBox="0 0 40 40">
                    <line x1="5" y1="20" x2="35" y2="20" stroke="#666" stroke-width="2" marker-end="url(#arrowhead-small)"/>
                </svg>
                <span><strong>Arc:</strong> Flow Direction</span>
            </div>
        </div>

        <h2>üìä Petri Net Diagram - Complaint Processing Flow</h2>
        <svg viewBox="0 0 1350 900" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="1350" height="900" fill="#fafafa"/>
            
            <!-- Title -->
            <text x="675" y="30" text-anchor="middle" font-size="22" font-weight="bold" fill="#2c3e50">
                UC-07: File Complaint - Petri Net Model with Abuse Detection
            </text>
            
            <!-- Define gradients -->
            <defs>
                <linearGradient id="normalGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#e3f2fd;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#bbdefb;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="validGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#e8f5e9;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#c8e6c9;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="invalidGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffebee;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ffcdd2;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="warningGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#fff3e0;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ffe0b2;stop-opacity:1" />
                </linearGradient>
            </defs>
            
            <!-- Places -->
            
            <!-- P_ComplaintDraft -->
            <g transform="translate(150, 200)">
                <circle r="60" fill="url(#normalGradient)" stroke="#1976d2" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_ComplaintDraft</text>
                <text y="15" text-anchor="middle" font-size="10">(User Input)</text>
                <!-- Token representing new complaint -->
                <circle cx="0" cy="-25" r="8" fill="#ee5a6f"/>
            </g>
            
            <!-- T_SubmitComplaint (Main Validation) -->
            <g transform="translate(350, 200)">
                <rect x="-20" y="-50" width="40" height="100" fill="#333" stroke="#000" stroke-width="2"/>
                <text y="70" text-anchor="middle" font-size="11" font-weight="bold">T_SubmitComplaint</text>
                <text y="85" text-anchor="middle" font-size="9">(Validate)</text>
            </g>
            
            <!-- P_ValidComplaint -->
            <g transform="translate(550, 120)">
                <circle r="60" fill="url(#validGradient)" stroke="#4caf50" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_ValidComplaint</text>
                <text y="15" text-anchor="middle" font-size="10">(Verified)</text>
            </g>
            
            <!-- P_InvalidComplaint -->
            <g transform="translate(550, 280)">
                <circle r="60" fill="url(#invalidGradient)" stroke="#f44336" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_InvalidComplaint</text>
                <text y="15" text-anchor="middle" font-size="10">(Rejected)</text>
            </g>
            
            <!-- P_AbuserDetected -->
            <g transform="translate(550, 450)">
                <circle r="60" fill="url(#warningGradient)" stroke="#ff9800" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_AbuserDetected</text>
                <text y="15" text-anchor="middle" font-size="10">(Frivolous)</text>
            </g>
            
            <!-- T_QueueComplaint -->
            <g transform="translate(750, 120)">
                <rect x="-20" y="-50" width="40" height="100" fill="#333" stroke="#000" stroke-width="2"/>
                <text y="70" text-anchor="middle" font-size="11" font-weight="bold">T_QueueComplaint</text>
                <text y="85" text-anchor="middle" font-size="9">(Assign Manager)</text>
            </g>
            
            <!-- P_ComplaintsPending -->
            <g transform="translate(950, 120)">
                <circle r="60" fill="url(#validGradient)" stroke="#4caf50" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_ComplaintsPending</text>
                <text y="15" text-anchor="middle" font-size="10">(Manager Queue)</text>
                <!-- Multiple tokens showing queue -->
                <circle cx="-20" cy="-25" r="6" fill="#4caf50"/>
                <circle cx="0" cy="-25" r="6" fill="#4caf50"/>
                <circle cx="20" cy="-25" r="6" fill="#4caf50"/>
            </g>
            
            <!-- T_IssueWarning -->
            <g transform="translate(750, 450)">
                <rect x="-20" y="-50" width="40" height="100" fill="#333" stroke="#000" stroke-width="2"/>
                <text y="70" text-anchor="middle" font-size="11" font-weight="bold">T_IssueWarning</text>
                <text y="85" text-anchor="middle" font-size="9">(Penalize)</text>
            </g>
            
            <!-- P_WarningsIssued -->
            <g transform="translate(950, 450)">
                <circle r="60" fill="url(#warningGradient)" stroke="#ff9800" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_WarningsIssued</text>
                <text y="15" text-anchor="middle" font-size="10">(User Warned)</text>
            </g>
            
            <!-- Additional Places for Complete Flow -->
            
            <!-- P_UserHistory -->
            <g transform="translate(150, 400)">
                <circle r="45" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
                <text y="0" text-anchor="middle" font-size="11">P_UserHistory</text>
                <text y="13" text-anchor="middle" font-size="9">(Past Complaints)</text>
                <!-- Tokens representing complaint history -->
                <circle cx="-15" cy="-15" r="5" fill="#e91e63"/>
                <circle cx="0" cy="-15" r="5" fill="#e91e63"/>
                <circle cx="15" cy="-15" r="5" fill="#e91e63"/>
            </g>
            
            <!-- P_ManagerAvailable -->
            <g transform="translate(950, 280)">
                <circle r="45" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
                <text y="0" text-anchor="middle" font-size="11">P_ManagerAvailable</text>
                <text y="13" text-anchor="middle" font-size="9">(For Review)</text>
                <!-- Manager token -->
                <circle cx="0" cy="-15" r="6" fill="#2ecc71"/>
            </g>
            
            <!-- P_ComplaintResolved -->
            <g transform="translate(1150, 120)">
                <circle r="60" fill="url(#validGradient)" stroke="#4caf50" stroke-width="3"/>
                <text y="0" text-anchor="middle" font-size="12" font-weight="bold">P_ComplaintResolved</text>
                <text y="15" text-anchor="middle" font-size="10">(Closed)</text>
            </g>
            
            <!-- P_LowPriority -->
            <g transform="translate(750, 280)">
                <circle r="50" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
                <text y="0" text-anchor="middle" font-size="11">P_LowPriority</text>
                <text y="13" text-anchor="middle" font-size="10">(Deprioritized)</text>
            </g>
            
            <!-- Arcs (Connections) -->
            
            <!-- P_ComplaintDraft -> T_SubmitComplaint -->
            <line x1="210" y1="200" x2="330" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="270" y="195" text-anchor="middle" font-size="10">submit</text>
            
            <!-- T_SubmitComplaint -> P_ValidComplaint (success path) -->
            <line x1="370" y1="170" x2="490" y2="120" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead-green)"/>
            <text x="430" y="140" text-anchor="middle" font-size="10" fill="#4caf50">valid</text>
            
            <!-- T_SubmitComplaint -> P_InvalidComplaint (invalid order) -->
            <line x1="370" y1="230" x2="490" y2="280" stroke="#f44336" stroke-width="2" marker-end="url(#arrowhead-red)"/>
            <text x="430" y="260" text-anchor="middle" font-size="10" fill="#f44336">invalid order</text>
            
            <!-- T_SubmitComplaint -> P_AbuserDetected (abuse detected) -->
            <line x1="370" y1="250" x2="450" y2="350" stroke="#ff9800" stroke-width="2"/>
            <line x1="450" y1="350" x2="490" y2="430" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
            <text x="420" y="340" text-anchor="middle" font-size="10" fill="#ff9800">abuse pattern</text>
            
            <!-- P_ValidComplaint -> T_QueueComplaint -->
            <line x1="610" y1="120" x2="730" y2="120" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="670" y="115" text-anchor="middle" font-size="10">process</text>
            
            <!-- T_QueueComplaint -> P_ComplaintsPending -->
            <line x1="770" y1="120" x2="890" y2="120" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead-green)"/>
            <text x="830" y="115" text-anchor="middle" font-size="10" fill="#4caf50">queued</text>
            
            <!-- P_AbuserDetected -> T_IssueWarning -->
            <line x1="610" y1="450" x2="730" y2="450" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
            <text x="670" y="445" text-anchor="middle" font-size="10" fill="#ff9800">warn</text>
            
            <!-- T_IssueWarning -> P_WarningsIssued -->
            <line x1="770" y1="450" x2="890" y2="450" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
            <text x="830" y="445" text-anchor="middle" font-size="10" fill="#ff9800">warned</text>
            
            <!-- P_UserHistory -> T_SubmitComplaint (input arc for checking) -->
            <line x1="195" y1="380" x2="340" y2="250" stroke="#e91e63" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-pink)"/>
            <text x="267" y="315" text-anchor="middle" font-size="9" fill="#e91e63">check history</text>
            
            <!-- P_InvalidComplaint -> P_LowPriority (some invalid become low priority) -->
            <line x1="610" y1="280" x2="700" y2="280" stroke="#ff9800" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-orange)"/>
            <text x="655" y="275" text-anchor="middle" font-size="9" fill="#ff9800">minor issue</text>
            
            <!-- P_LowPriority -> P_ComplaintsPending (eventually processed) -->
            <line x1="800" y1="260" x2="900" y2="160" stroke="#ff9800" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-orange)"/>
            <text x="850" y="210" text-anchor="middle" font-size="9" fill="#ff9800">low priority</text>
            
            <!-- P_ManagerAvailable -> P_ComplaintsPending (resource arc) -->
            <line x1="950" y1="235" x2="950" y2="180" stroke="#4caf50" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="970" y="207" text-anchor="middle" font-size="9" fill="#4caf50">assigns</text>
            
            <!-- P_ComplaintsPending -> P_ComplaintResolved -->
            <line x1="1010" y1="120" x2="1090" y2="120" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead-green)"/>
            <text x="1050" y="115" text-anchor="middle" font-size="10" fill="#4caf50">resolved</text>
            
            <!-- Inhibitor arc for blacklist -->
            <g>
                <line x1="150" y1="250" x2="150" y2="500" stroke="#9c27b0" stroke-width="1" stroke-dasharray="3,3"/>
                <line x1="150" y1="500" x2="350" y2="500" stroke="#9c27b0" stroke-width="1" stroke-dasharray="3,3"/>
                <line x1="350" y1="500" x2="350" y2="250" stroke="#9c27b0" stroke-width="1" stroke-dasharray="3,3"/>
                <circle cx="350" cy="475" r="5" fill="white" stroke="#9c27b0" stroke-width="2"/>
                <text x="250" y="520" font-size="9" fill="#9c27b0">blacklist check</text>
            </g>
            
            <!-- Annotations -->
            <rect x="50" y="600" width="400" height="120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
            <text x="60" y="620" font-size="11" font-weight="bold">Validation Rules:</text>
            <text x="60" y="640" font-size="10">‚Ä¢ Order must exist and belong to complainant</text>
            <text x="60" y="655" font-size="10">‚Ä¢ No duplicate complaints for same order/target</text>
            <text x="60" y="670" font-size="10">‚Ä¢ User complaint history checked for patterns</text>
            <text x="60" y="685" font-size="10">‚Ä¢ Frivolous complaints trigger warnings</text>
            <text x="60" y="700" font-size="10">‚Ä¢ After 3 warnings ‚Üí user blacklisted</text>
            
            <rect x="500" y="600" width="400" height="120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
            <text x="510" y="620" font-size="11" font-weight="bold">Token Flow:</text>
            <text x="510" y="640" font-size="10">‚Ä¢ Each complaint = 1 token</text>
            <text x="510" y="655" font-size="10">‚Ä¢ Valid complaints queue for manager</text>
            <text x="510" y="670" font-size="10">‚Ä¢ Invalid complaints may become warnings</text>
            <text x="510" y="685" font-size="10">‚Ä¢ Low priority complaints delayed</text>
            <text x="510" y="700" font-size="10">‚Ä¢ Manager processes queue FIFO</text>
            
            <rect x="950" y="600" width="350" height="120" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
            <text x="960" y="620" font-size="11" font-weight="bold">Priority System:</text>
            <text x="960" y="640" font-size="10">‚Ä¢ VIP complaints ‚Üí High priority</text>
            <text x="960" y="655" font-size="10">‚Ä¢ First-time complainers ‚Üí Normal priority</text>
            <text x="960" y="670" font-size="10">‚Ä¢ Frequent complainers ‚Üí Low priority</text>
            <text x="960" y="685" font-size="10">‚Ä¢ Abusers ‚Üí Warnings + possible block</text>
            <text x="960" y="700" font-size="10">‚Ä¢ System issues ‚Üí Immediate escalation</text>
            
            <!-- Legend for priority levels -->
            <g transform="translate(100, 780)">
                <rect x="0" y="0" width="1150" height="50" fill="#f5f5f5" stroke="#999" rx="5"/>
                <text x="20" y="30" font-size="12" font-weight="bold">Priority Levels:</text>
                <rect x="150" y="15" width="60" height="20" fill="#f44336" rx="3"/>
                <text x="180" y="29" text-anchor="middle" font-size="10" fill="white">HIGH</text>
                <rect x="230" y="15" width="60" height="20" fill="#2196f3" rx="3"/>
                <text x="260" y="29" text-anchor="middle" font-size="10" fill="white">NORMAL</text>
                <rect x="310" y="15" width="60" height="20" fill="#9e9e9e" rx="3"/>
                <text x="340" y="29" text-anchor="middle" font-size="10" fill="white">LOW</text>
                <text x="400" y="30" font-size="10">Processing Time:</text>
                <text x="520" y="30" font-size="10">HIGH: &lt;2hrs | NORMAL: &lt;24hrs | LOW: &lt;72hrs</text>
            </g>
            
            <!-- Arrow definitions -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#666"/>
                </marker>
                <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#4caf50"/>
                </marker>
                <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#f44336"/>
                </marker>
                <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#ff9800"/>
                </marker>
                <marker id="arrowhead-pink" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#e91e63"/>
                </marker>
            </defs>
        </svg>

        <h2>üìù Normal Flow Description</h2>
        <div class="normal-flow">
            <strong>Successful Complaint Filing:</strong>
            <ol>
                <li>Customer drafts complaint with type, description, evidence (token in P_ComplaintDraft)</li>
                <li>Clicks "Submit Complaint" (fires T_SubmitComplaint transition)</li>
                <li>System validates order ownership and checks for duplicates</li>
                <li>System analyzes user's complaint history for abuse patterns</li>
                <li>Valid complaint moves to P_ValidComplaint</li>
                <li>T_QueueComplaint fires, assigning priority based on user status</li>
                <li>Complaint token placed in P_ComplaintsPending with appropriate priority</li>
                <li>Manager notified via dashboard (consumes manager availability token)</li>
                <li>Manager processes complaint (token moves to P_ComplaintResolved)</li>
            </ol>
        </div>

        <h2>‚ö†Ô∏è Exceptional Scenarios</h2>
        <div class="error-flow">
            <strong>E1 - Invalid Order:</strong><br>
            ‚Ä¢ Order not found or not owned by user<br>
            ‚Ä¢ Token moves to P_InvalidComplaint<br>
            ‚Ä¢ Error: "Order not found or unauthorized"<br>
            ‚Ä¢ No complaint created
        </div>

        <div class="warning-flow">
            <strong>E2 - Abuse Pattern Detected:</strong><br>
            ‚Ä¢ User has filed &gt;5 complaints in 30 days<br>
            ‚Ä¢ Previous complaints marked as frivolous<br>
            ‚Ä¢ Token moves to P_AbuserDetected<br>
            ‚Ä¢ T_IssueWarning fires ‚Üí P_WarningsIssued<br>
            ‚Ä¢ User reputation score decreased<br>
            ‚Ä¢ After 3 warnings: User blacklisted (inhibitor arc activated)
        </div>

        <div class="warning-flow">
            <strong>E3 - Low Priority Assignment:</strong><br>
            ‚Ä¢ Minor issues or frequent complainer<br>
            ‚Ä¢ Token moves to P_LowPriority<br>
            ‚Ä¢ Eventually reaches P_ComplaintsPending<br>
            ‚Ä¢ Processed after high/normal priority complaints
        </div>

        <h2>üíª Detailed Pseudocode</h2>
        <div class="pseudocode">
<span class="comment">// UC-07: File Complaint - Petri Net Implementation</span>

<span class="keyword">CLASS</span> <span class="function">ReputationService</span>:
    
    <span class="keyword">FUNCTION</span> fileComplaint(orderId: String, complainantId: String, complaintData: ComplaintInput):
        <span class="keyword">INPUT</span>: {
            orderId: String,
            complainantId: String,
            complaintData: {
                type: String, <span class="comment">// CHEF, DELIVERY, SYSTEM, OTHER</span>
                targetUserId: String,
                description: String,
                evidence: File[] (optional)
            }
        }
        
        <span class="comment">// Initial state: Token in P_ComplaintDraft</span>
        
        <span class="comment">// Fire T_SubmitComplaint transition with validation</span>
        
        <span class="comment">// Step 1: Validate Order Ownership</span>
        order = OrderRepository.findById(orderId)
        
        <span class="keyword">IF</span> order == null:
            <span class="comment">// Token moves to P_InvalidComplaint</span>
            <span class="keyword">RETURN</span> Result(
                error: <span class="string">"Order not found"</span>,
                nextPlace: <span class="string">"P_InvalidComplaint"</span>
            )
        
        <span class="keyword">IF</span> order.customerId != complainantId:
            <span class="comment">// Token moves to P_InvalidComplaint</span>
            <span class="keyword">RETURN</span> Result(
                error: <span class="string">"Not authorized to file complaint for this order"</span>,
                nextPlace: <span class="string">"P_InvalidComplaint"</span>
            )
        
        <span class="comment">// Step 2: Check for Duplicate Complaint</span>
        existingComplaint = ComplaintRepository.findByOrderAndTarget(
            orderId, complainantId, complaintData.targetUserId
        )
        
        <span class="keyword">IF</span> existingComplaint != null:
            <span class="keyword">RETURN</span> Result(
                error: <span class="string">"Complaint already filed for this order and target"</span>,
                existingComplaintId: existingComplaint.id,
                nextPlace: <span class="string">"P_InvalidComplaint"</span>
            )
        
        <span class="comment">// Step 3: Check User Complaint History (P_UserHistory input)</span>
        userHistory = ComplaintRepository.getUserComplaintHistory(complainantId)
        abuseScore = calculateAbuseScore(userHistory)
        
        <span class="keyword">IF</span> abuseScore.isAbuser:
            <span class="comment">// Token moves to P_AbuserDetected</span>
            <span class="keyword">RETURN</span> handleAbusiveComplaint(complainantId, abuseScore)
        
        <span class="comment">// Step 4: Check if User is Blacklisted (Inhibitor Arc)</span>
        user = UserRepository.findById(complainantId)
        <span class="keyword">IF</span> user.status == <span class="string">"BLACKLISTED"</span>:
            <span class="keyword">RETURN</span> Result(
                error: <span class="string">"Account restricted from filing complaints"</span>,
                nextPlace: <span class="string">"BLOCKED"</span>
            )
        
        <span class="comment">// Valid complaint - Token moves to P_ValidComplaint</span>
        
        <span class="comment">// Step 5: Create Complaint Record</span>
        complaint = new Complaint()
        complaint.orderId = orderId
        complaint.complainantId = complainantId
        complaint.targetUserId = complaintData.targetUserId
        complaint.type = complaintData.type
        complaint.description = complaintData.description
        complaint.status = <span class="string">"PENDING"</span>
        complaint.priority = determinePriority(user, abuseScore)
        complaint.createdAt = now()
        
        <span class="comment">// Upload evidence if provided</span>
        <span class="keyword">IF</span> complaintData.evidence != null:
            evidenceUrls = FileService.uploadEvidence(complaintData.evidence)
            complaint.evidenceUrls = evidenceUrls
        
        ComplaintRepository.save(complaint)
        
        <span class="comment">// Fire T_QueueComplaint transition</span>
        <span class="keyword">RETURN</span> queueComplaint(complaint)
    
    <span class="keyword">FUNCTION</span> queueComplaint(complaint: Complaint):
        <span class="comment">// Token moves from P_ValidComplaint to P_ComplaintsPending</span>
        
        <span class="comment">// Assign to manager queue based on priority</span>
        <span class="keyword">SWITCH</span> complaint.priority:
            <span class="keyword">CASE</span> <span class="string">"HIGH"</span>:
                ManagerQueueService.addHighPriority(complaint)
                targetResponseTime = <span class="string">"2 hours"</span>
            
            <span class="keyword">CASE</span> <span class="string">"LOW"</span>:
                <span class="comment">// Goes through P_LowPriority first</span>
                ManagerQueueService.addLowPriority(complaint)
                targetResponseTime = <span class="string">"72 hours"</span>
            
            <span class="keyword">DEFAULT</span>:
                ManagerQueueService.addNormalPriority(complaint)
                targetResponseTime = <span class="string">"24 hours"</span>
        
        <span class="comment">// Notify manager dashboard</span>
        NotificationService.notifyManager({
            complaintId: complaint.id,
            priority: complaint.priority,
            type: complaint.type,
            targetResponse: targetResponseTime
        })
        
        <span class="comment">// Token now in P_ComplaintsPending</span>
        <span class="keyword">RETURN</span> Result(
            success: true,
            complaintId: complaint.id,
            status: <span class="string">"PENDING"</span>,
            priority: complaint.priority,
            message: <span class="string">"Complaint filed successfully. Expected response: "</span> + targetResponseTime,
            nextPlace: <span class="string">"P_ComplaintsPending"</span>
        )
    
    <span class="keyword">FUNCTION</span> handleAbusiveComplaint(userId: String, abuseScore: AbuseScore):
        <span class="comment">// Fire T_IssueWarning transition</span>
        
        user = UserRepository.findById(userId)
        reputation = ReputationRepository.findByUserId(userId)
        
        reputation.warningsCount += 1
        reputation.complaintAbuseScore = abuseScore.score
        
        <span class="keyword">IF</span> reputation.warningsCount >= MAX_WARNINGS:
            <span class="comment">// Blacklist user</span>
            user.status = <span class="string">"BLACKLISTED"</span>
            UserRepository.update(user)
            
            <span class="keyword">RETURN</span> Result(
                error: <span class="string">"Account blacklisted due to complaint abuse"</span>,
                warningsCount: reputation.warningsCount,
                nextPlace: <span class="string">"P_WarningsIssued"</span>
            )
        
        <span class="comment">// Issue warning</span>
        warning = new Warning()
        warning.userId = userId
        warning.type = <span class="string">"COMPLAINT_ABUSE"</span>
        warning.description = <span class="string">"Frivolous complaint pattern detected"</span>
        warning.issuedAt = now()
        WarningRepository.save(warning)
        
        ReputationRepository.update(reputation)
        
        <span class="comment">// Token moves to P_WarningsIssued</span>
        <span class="keyword">RETURN</span> Result(
            error: <span class="string">"Warning issued for complaint abuse"</span>,
            warningsCount: reputation.warningsCount,
            remainingBeforeBlacklist: MAX_WARNINGS - reputation.warningsCount,
            nextPlace: <span class="string">"P_WarningsIssued"</span>
        )
    
    <span class="keyword">FUNCTION</span> calculateAbuseScore(history: List&lt;Complaint&gt;):
        score = 0.0
        
        <span class="comment">// Check complaint frequency</span>
        recentComplaints = history.filter(c -> 
            c.createdAt > now() - 30.days
        )
        
        <span class="keyword">IF</span> recentComplaints.count > 5:
            score += 0.3
        
        <span class="comment">// Check resolution rate</span>
        resolvedAsFrivolous = history.filter(c -> 
            c.resolution == <span class="string">"FRIVOLOUS"</span> OR c.resolution == <span class="string">"NO_ACTION"</span>
        ).count
        
        frivolousRate = resolvedAsFrivolous / max(1, history.count)
        <span class="keyword">IF</span> frivolousRate > 0.5:
            score += 0.4
        
        <span class="comment">// Check complaint patterns</span>
        <span class="keyword">IF</span> hasRepetitiveComplaints(history):
            score += 0.3
        
        <span class="keyword">RETURN</span> AbuseScore(
            score: score,
            isAbuser: score >= 0.6,
            recentCount: recentComplaints.count,
            frivolousRate: frivolousRate
        )
    
    <span class="keyword">FUNCTION</span> determinePriority(user: User, abuseScore: AbuseScore):
        <span class="comment">// VIP users get higher priority</span>
        <span class="keyword">IF</span> user.role == <span class="string">"VIP"</span>:
            <span class="keyword">RETURN</span> <span class="string">"HIGH"</span>
        
        <span class="comment">// System issues get high priority</span>
        <span class="keyword">IF</span> complaintData.type == <span class="string">"SYSTEM"</span>:
            <span class="keyword">RETURN</span> <span class="string">"HIGH"</span>
        
        <span class="comment">// Frequent complainers get low priority</span>
        <span class="keyword">IF</span> abuseScore.score > 0.3:
            <span class="keyword">RETURN</span> <span class="string">"LOW"</span>
        
        <span class="comment">// First-time complainers get normal priority</span>
        <span class="keyword">IF</span> abuseScore.recentCount == 0:
            <span class="keyword">RETURN</span> <span class="string">"NORMAL"</span>
        
        <span class="keyword">RETURN</span> <span class="string">"NORMAL"</span>

<span class="comment">// Petri Net State Management</span>
<span class="keyword">CLASS</span> <span class="function">ComplaintPetriNet</span>:
    places = {
        <span class="string">"P_ComplaintDraft"</span>: [],
        <span class="string">"P_ValidComplaint"</span>: [],
        <span class="string">"P_InvalidComplaint"</span>: [],
        <span class="string">"P_AbuserDetected"</span>: [],
        <span class="string">"P_ComplaintsPending"</span>: [],
        <span class="string">"P_WarningsIssued"</span>: [],
        <span class="string">"P_UserHistory"</span>: [], <span class="comment">// Contains user's past complaints</span>
        <span class="string">"P_LowPriority"</span>: [],
        <span class="string">"P_ComplaintResolved"</span>: []
    }
    
    <span class="keyword">FUNCTION</span> fireTransition(transitionName: String, token: Complaint):
        <span class="keyword">SWITCH</span> transitionName:
            <span class="keyword">CASE</span> <span class="string">"T_SubmitComplaint"</span>:
                removeToken(<span class="string">"P_ComplaintDraft"</span>, token)
                
                <span class="comment">// Check user history (input from P_UserHistory)</span>
                userHistory = getTokens(<span class="string">"P_UserHistory"</span>, token.userId)
                validationResult = validate(token, userHistory)
                
                <span class="keyword">IF</span> validationResult.isValid:
                    addToken(<span class="string">"P_ValidComplaint"</span>, token)
                <span class="keyword">ELSE IF</span> validationResult.isAbuse:
                    addToken(<span class="string">"P_AbuserDetected"</span>, token)
                <span class="keyword">ELSE</span>:
                    addToken(<span class="string">"P_InvalidComplaint"</span>, token)
            
            <span class="keyword">CASE</span> <span class="string">"T_QueueComplaint"</span>:
                removeToken(<span class="string">"P_ValidComplaint"</span>, token)
                
                <span class="keyword">IF</span> token.priority == <span class="string">"LOW"</span>:
                    addToken(<span class="string">"P_LowPriority"</span>, token)
                    <span class="comment">// Eventually moves to P_ComplaintsPending</span>
                    scheduleLowPriorityProcessing(token)
                <span class="keyword">ELSE</span>:
                    addToken(<span class="string">"P_ComplaintsPending"</span>, token)
            
            <span class="keyword">CASE</span> <span class="string">"T_IssueWarning"</span>:
                removeToken(<span class="string">"P_AbuserDetected"</span>, token)
                issueWarning(token.userId)
                addToken(<span class="string">"P_WarningsIssued"</span>, token)
</div>

        <h2>üìä State Transitions Table</h2>
        <table>
            <tr>
                <th>Current Place</th>
                <th>Transition</th>
                <th>Condition</th>
                <th>Next Place</th>
                <th>Action</th>
            </tr>
            <tr>
                <td>P_ComplaintDraft</td>
                <td>T_SubmitComplaint</td>
                <td>Valid order & no duplicates</td>
                <td>P_ValidComplaint</td>
                <td>Create complaint record</td>
            </tr>
            <tr>
                <td>P_ComplaintDraft</td>
                <td>T_SubmitComplaint</td>
                <td>Invalid order/unauthorized</td>
                <td>P_InvalidComplaint</td>
                <td>Return error message</td>
            </tr>
            <tr>
                <td>P_ComplaintDraft</td>
                <td>T_SubmitComplaint</td>
                <td>Abuse pattern detected</td>
                <td>P_AbuserDetected</td>
                <td>Flag for warning</td>
            </tr>
            <tr>
                <td>P_ValidComplaint</td>
                <td>T_QueueComplaint</td>
                <td>Priority assigned</td>
                <td>P_ComplaintsPending</td>
                <td>Notify manager, add to queue</td>
            </tr>
            <tr>
                <td>P_AbuserDetected</td>
                <td>T_IssueWarning</td>
                <td>Warning threshold not exceeded</td>
                <td>P_WarningsIssued</td>
                <td>Issue warning, update reputation</td>
            </tr>
            <tr>
                <td>P_LowPriority</td>
                <td>(delayed)</td>
                <td>Time elapsed</td>
                <td>P_ComplaintsPending</td>
                <td>Add to queue with low priority</td>
            </tr>
            <tr>
                <td>P_ComplaintsPending</td>
                <td>(manager process)</td>
                <td>Manager reviews</td>
                <td>P_ComplaintResolved</td>
                <td>Resolution recorded</td>
            </tr>
        </table>

        <h2>üéØ Key Petri Net Properties</h2>
        <div class="info-box">
            <strong>1. Reachability:</strong> All places reachable from P_ComplaintDraft<br>
            <strong>2. Boundedness:</strong> Maximum tokens limited by system constraints<br>
            <strong>3. Liveness:</strong> No deadlocks - all paths lead to resolution or rejection<br>
            <strong>4. Fairness:</strong> Priority system ensures important complaints processed first<br>
            <strong>5. Conservation:</strong> Complaint tokens tracked through entire lifecycle<br>
            <strong>6. Inhibitor Arc:</strong> Blacklisted users cannot create new complaint tokens
        </div>

        <h2>üß™ Test Scenarios</h2>
        <div class="normal-flow">
            <strong>Test 1: Valid Complaint Flow</strong><br>
            ‚Ä¢ Initial: Token in P_ComplaintDraft<br>
            ‚Ä¢ User files legitimate complaint about cold food<br>
            ‚Ä¢ Expected: Token flows through P_ValidComplaint ‚Üí P_ComplaintsPending<br>
            ‚Ä¢ Manager notified with NORMAL priority<br>
            ‚Ä¢ Resolution within 24 hours
        </div>

        <div class="error-flow">
            <strong>Test 2: Abuse Detection</strong><br>
            ‚Ä¢ User has 6 complaints in last 30 days<br>
            ‚Ä¢ 4 marked as frivolous<br>
            ‚Ä¢ Expected: Token moves to P_AbuserDetected<br>
            ‚Ä¢ Warning issued, reputation decreased<br>
            ‚Ä¢ Future complaints marked LOW priority
        </div>

        <div class="warning-flow">
            <strong>Test 3: Blacklist Enforcement</strong><br>
            ‚Ä¢ User with 3 previous warnings attempts complaint<br>
            ‚Ä¢ Inhibitor arc prevents token creation<br>
            ‚Ä¢ Expected: Complaint blocked immediately<br>
            ‚Ä¢ Error: "Account restricted from filing complaints"
        </div>

        <div class="normal-flow">
            <strong>Test 4: VIP Priority</strong><br>
            ‚Ä¢ VIP customer files complaint<br>
            ‚Ä¢ Expected: HIGH priority assigned<br>
            ‚Ä¢ Manager response within 2 hours<br>
            ‚Ä¢ Token fast-tracked through P_ComplaintsPending
        </div>
    </div>
</body>
</html>
