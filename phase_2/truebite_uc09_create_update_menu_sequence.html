<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueBite - UC-09 Create / Update Menu Sequence Diagram</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #84fab0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }
        h1::before {
            content: "üë®‚Äçüç≥";
            margin-right: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .info-box {
            background: linear-gradient(135deg, #84fab015 0%, #8fd3f415 100%);
            border-left: 4px solid #84fab0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .normal-flow {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .error-flow {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .success-flow {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        svg {
            width: 100%;
            max-width: 1250px;
            height: auto;
            margin: 20px 0;
        }
        .pseudocode {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        .pseudocode .comment {
            color: #95a5a6;
        }
        .pseudocode .keyword {
            color: #e74c3c;
            font-weight: bold;
        }
        .pseudocode .function {
            color: #3498db;
        }
        .pseudocode .string {
            color: #2ecc71;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th {
            background: #84fab0;
            color: #2c3e50;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ecf0f1;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .user-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .chef { background: #e74c3c; color: white; }
        .menu-form {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background: #fafafa;
        }
        .menu-form h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .dish-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            gap: 15px;
        }
        .dish-image {
            width: 100px;
            height: 100px;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }
        .dish-details {
            flex: 1;
        }
        .dish-status {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }
        .status-active { background: #4caf50; color: white; }
        .status-unavailable { background: #f44336; color: white; }
        .status-draft { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TrueBite - UC-09: Create / Update Menu (Chef)</h1>
        
        <div class="info-box">
            <strong>Use Case:</strong> UC-09 - Menu Management by Chef<br>
            <strong>Actor:</strong> 
            <span class="user-badge chef">Chef</span><br>
            <strong>Goal:</strong> Create new dishes and update existing menu items<br>
            <strong>Preconditions:</strong> Chef authenticated, has menu management permissions<br>
            <strong>Postconditions:</strong> Menu updated with new/modified dishes, changes visible to customers
        </div>

        <h2>üçΩÔ∏è Menu Management Interface</h2>
        <div class="menu-form">
            <h3>Add New Dish</h3>
            <div class="form-group">
                <label>Dish Name:</label>
                <input type="text" placeholder="e.g., Grilled Salmon" value="Truffle Pasta">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea rows="3">Fresh homemade pasta with black truffle, parmesan cheese, and cream sauce</textarea>
            </div>
            <div class="form-group">
                <label>Category:</label>
                <select>
                    <option>Appetizers</option>
                    <option selected>Main Courses</option>
                    <option>Desserts</option>
                    <option>Beverages</option>
                </select>
            </div>
            <div class="form-group">
                <label>Price:</label>
                <input type="number" step="0.01" value="28.99">
            </div>
            <div class="form-group">
                <label>Dietary Tags:</label>
                <input type="text" placeholder="vegetarian, gluten-free, etc." value="vegetarian">
            </div>
            <div class="form-group">
                <label>Image:</label>
                <button style="padding: 8px 15px;">üì∑ Upload Photo</button>
            </div>
        </div>

        <div class="dish-card">
            <div class="dish-image">üçù</div>
            <div class="dish-details">
                <h4>Truffle Pasta <span class="dish-status status-active">ACTIVE</span></h4>
                <p>Fresh homemade pasta with black truffle...</p>
                <p><strong>$28.99</strong> | Main Courses | Vegetarian</p>
                <button>‚úèÔ∏è Edit</button> <button>‚ùå Mark Unavailable</button>
            </div>
        </div>

        <h2>üìä Main Sequence Diagram - Menu Management Flow</h2>
        <svg viewBox="0 0 1250 1400" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="1250" height="1400" fill="#fafafa"/>
            
            <!-- Title -->
            <text x="625" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#2c3e50">
                Chef Menu Management - Create &amp; Update Flow
            </text>
            
            <!-- Actors and Objects -->
            <!-- Chef/UI -->
            <rect x="50" y="60" width="100" height="40" fill="#ffebee" stroke="#e74c3c" stroke-width="2" rx="5"/>
            <text x="100" y="85" text-anchor="middle" font-weight="bold">Chef/UI</text>
            <line x1="100" y1="100" x2="100" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- MenuController -->
            <rect x="200" y="60" width="130" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
            <text x="265" y="85" text-anchor="middle" font-weight="bold">MenuController</text>
            <line x1="265" y1="100" x2="265" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- MenuService -->
            <rect x="380" y="60" width="120" height="40" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
            <text x="440" y="85" text-anchor="middle" font-weight="bold">MenuService</text>
            <line x1="440" y1="100" x2="440" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- DishRepository -->
            <rect x="550" y="60" width="130" height="40" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5"/>
            <text x="615" y="85" text-anchor="middle" font-weight="bold">DishRepository</text>
            <line x1="615" y1="100" x2="615" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- ValidationService -->
            <rect x="730" y="60" width="140" height="40" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5"/>
            <text x="800" y="85" text-anchor="middle" font-weight="bold">ValidationService</text>
            <line x1="800" y1="100" x2="800" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- FileService -->
            <rect x="920" y="60" width="110" height="40" fill="#e0f2f1" stroke="#009688" stroke-width="2" rx="5"/>
            <text x="975" y="85" text-anchor="middle" font-weight="bold">FileService</text>
            <line x1="975" y1="100" x2="975" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- Database -->
            <rect x="1080" y="60" width="100" height="40" fill="#fce4ec" stroke="#e91e63" stroke-width="2" rx="5"/>
            <text x="1130" y="85" text-anchor="middle" font-weight="bold">Database</text>
            <line x1="1130" y1="100" x2="1130" y2="1350" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
            
            <!-- PART 1: Create New Dish Flow -->
            <rect x="30" y="120" width="1190" height="580" fill="none" stroke="#4caf50" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="140" font-size="14" fill="#4caf50" font-weight="bold">FLOW 1: Create New Dish</text>
            
            <!-- 1. Open Menu Management -->
            <line x1="100" y1="160" x2="265" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="182" y="155" text-anchor="middle" font-size="12">1: openMenuManagement(chefId)</text>
            
            <!-- 2. Load Current Menu -->
            <line x1="265" y1="180" x2="440" y2="180" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="352" y="175" text-anchor="middle" font-size="12">2: getChefMenu(chefId)</text>
            
            <!-- 3. Return Menu List -->
            <line x1="440" y1="200" x2="265" y2="200" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="352" y="195" text-anchor="middle" font-size="12">3: List&lt;Dish&gt;</text>
            
            <!-- 4. Display Menu -->
            <line x1="265" y1="220" x2="100" y2="220" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="182" y="215" text-anchor="middle" font-size="12">4: displayMenu(dishes)</text>
            
            <!-- 5. Click Add Dish -->
            <rect x="105" y="240" width="90" height="25" fill="#e8f5e9" stroke="#4caf50" rx="3"/>
            <text x="150" y="257" text-anchor="middle" font-size="11">clickAddDish()</text>
            
            <!-- 6. Submit New Dish -->
            <line x1="100" y1="290" x2="265" y2="290" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="182" y="285" text-anchor="middle" font-size="11">6: createDish(name="Truffle Pasta",</text>
            <text x="182" y="300" text-anchor="middle" font-size="11">price=28.99, category="Main",</text>
            <text x="182" y="315" text-anchor="middle" font-size="11">description, tags, image)</text>
            
            <!-- 7. Validate Input -->
            <line x1="265" y1="340" x2="800" y2="340" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="532" y="335" text-anchor="middle" font-size="12">7: validateDishData(dishData)</text>
            
            <!-- 8. Validation Checks -->
            <rect x="805" y="350" width="140" height="50" fill="#f3e5f5" stroke="#333" rx="3"/>
            <text x="875" y="368" text-anchor="middle" font-size="10">‚Ä¢ Name not empty</text>
            <text x="875" y="381" text-anchor="middle" font-size="10">‚Ä¢ Price > 0</text>
            <text x="875" y="394" text-anchor="middle" font-size="10">‚Ä¢ Category valid</text>
            
            <!-- 9. Validation Success -->
            <line x1="800" y1="420" x2="265" y2="420" stroke="#4caf50" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-green)"/>
            <text x="532" y="415" text-anchor="middle" font-size="12" fill="#4caf50">9: valid = true</text>
            
            <!-- 10. Check Duplicate Name -->
            <line x1="265" y1="450" x2="615" y2="450" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="440" y="445" text-anchor="middle" font-size="12">10: checkDuplicateName(name, chefId)</text>
            
            <!-- 11. Query Database -->
            <line x1="615" y1="470" x2="1130" y2="470" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="872" y="465" text-anchor="middle" font-size="11">11: SELECT * FROM dishes</text>
            <text x="872" y="480" text-anchor="middle" font-size="11">WHERE name = ? AND chef_id = ?</text>
            
            <!-- 12. No Duplicate -->
            <line x1="1130" y1="500" x2="615" y2="500" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="872" y="495" text-anchor="middle" font-size="12">12: null (no duplicate)</text>
            
            <!-- 13. Upload Image -->
            <line x1="265" y1="530" x2="975" y2="530" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="620" y="525" text-anchor="middle" font-size="12">13: uploadImage(imageFile)</text>
            
            <!-- 14. Store Image -->
            <rect x="980" y="540" width="100" height="30" fill="#e0f2f1" stroke="#333" rx="3"/>
            <text x="1030" y="558" text-anchor="middle" font-size="11">storeToS3()</text>
            
            <!-- 15. Return Image URL -->
            <line x1="975" y1="580" x2="265" y2="580" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="620" y="575" text-anchor="middle" font-size="12">15: imageUrl</text>
            
            <!-- 16. Create Dish -->
            <line x1="265" y1="610" x2="440" y2="610" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="352" y="605" text-anchor="middle" font-size="12">16: createDish(dishData, imageUrl)</text>
            
            <!-- 17. Save to Database -->
            <line x1="440" y1="630" x2="615" y2="630" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="527" y="625" text-anchor="middle" font-size="12">17: save(dish)</text>
            
            <!-- 18. Insert Dish -->
            <line x1="615" y1="650" x2="1130" y2="650" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="872" y="645" text-anchor="middle" font-size="11">18: INSERT INTO dishes</text>
            <text x="872" y="660" text-anchor="middle" font-size="11">(name, price, category, status)</text>
            
            <!-- 19. Success Response -->
            <line x1="440" y1="680" x2="100" y2="680" stroke="#4caf50" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-green)"/>
            <text x="270" y="675" text-anchor="middle" font-size="12" fill="#4caf50">19: success {dishId: 123}</text>
            
            <!-- PART 2: Update Existing Dish -->
            <rect x="30" y="720" width="1190" height="450" fill="none" stroke="#1976d2" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="740" font-size="14" fill="#1976d2" font-weight="bold">FLOW 2: Update Existing Dish</text>
            
            <!-- 20. Select Dish to Edit -->
            <line x1="100" y1="770" x2="265" y2="770" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="182" y="765" text-anchor="middle" font-size="12">20: getDish(dishId=45)</text>
            
            <!-- 21. Fetch Dish Details -->
            <line x1="265" y1="790" x2="615" y2="790" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="440" y="785" text-anchor="middle" font-size="12">21: findById(dishId)</text>
            
            <!-- 22. Return Dish -->
            <line x1="615" y1="810" x2="265" y2="810" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="440" y="805" text-anchor="middle" font-size="12">22: Dish object</text>
            
            <!-- 23. Display Edit Form -->
            <line x1="265" y1="830" x2="100" y2="830" stroke="#333" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
            <text x="182" y="825" text-anchor="middle" font-size="12">23: showEditForm(dish)</text>
            
            <!-- 24. Submit Updates -->
            <line x1="100" y1="860" x2="265" y2="860" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="182" y="855" text-anchor="middle" font-size="12">24: updateDish(dishId,</text>
            <text x="182" y="870" text-anchor="middle" font-size="11">price=32.99, status="UNAVAILABLE")</text>
            
            <!-- 25. Validate Updates -->
            <line x1="265" y1="900" x2="800" y2="900" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="532" y="895" text-anchor="middle" font-size="12">25: validateUpdate(updates)</text>
            
            <!-- 26. Valid -->
            <line x1="800" y1="920" x2="265" y2="920" stroke="#4caf50" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-green)"/>
            <text x="532" y="915" text-anchor="middle" font-size="12" fill="#4caf50">26: valid</text>
            
            <!-- 27. Update Service -->
            <line x1="265" y1="950" x2="440" y2="950" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="352" y="945" text-anchor="middle" font-size="12">27: updateDish(dishId, updates)</text>
            
            <!-- 28. Update Repository -->
            <line x1="440" y1="980" x2="615" y2="980" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="527" y="975" text-anchor="middle" font-size="12">28: update(dishId, updates)</text>
            
            <!-- 29. Update Database -->
            <line x1="615" y1="1010" x2="1130" y2="1010" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
            <text x="872" y="1005" text-anchor="middle" font-size="11">29: UPDATE dishes SET</text>
            <text x="872" y="1020" text-anchor="middle" font-size="11">price = ?, status = ?, updated_at = NOW()</text>
            <text x="872" y="1035" text-anchor="middle" font-size="11">WHERE dish_id = ?</text>
            
            <!-- 30. Log Change -->
            <rect x="445" y="1060" width="120" height="30" fill="#e8f5e9" stroke="#333" rx="3"/>
            <text x="505" y="1078" text-anchor="middle" font-size="11">logMenuChange()</text>
            
            <!-- 31. Clear Cache -->
            <rect x="270" y="1100" width="100" height="30" fill="#e3f2fd" stroke="#333" rx="3"/>
            <text x="320" y="1118" text-anchor="middle" font-size="11">clearCache()</text>
            
            <!-- 32. Success Response -->
            <line x1="265" y1="1150" x2="100" y2="1150" stroke="#4caf50" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead-green)"/>
            <text x="182" y="1145" text-anchor="middle" font-size="12" fill="#4caf50">32: success "Dish updated"</text>
            
            <!-- PART 3: Exceptional Flows -->
            <rect x="30" y="1190" width="1190" height="130" fill="none" stroke="#f44336" stroke-width="2" stroke-dasharray="10,5" rx="5"/>
            <text x="40" y="1210" font-size="14" fill="#f44336" font-weight="bold">EXCEPTIONAL FLOWS</text>
            
            <!-- E1: Invalid Price -->
            <g transform="translate(50, 1230)">
                <rect x="0" y="0" width="280" height="50" fill="#ffebee" stroke="#f44336" rx="3"/>
                <text x="140" y="20" text-anchor="middle" font-size="11" font-weight="bold">E1: Invalid Price</text>
                <text x="140" y="35" text-anchor="middle" font-size="10">Price ‚â§ 0 or non-numeric</text>
                <text x="140" y="50" text-anchor="middle" font-size="10">‚Üí "Price must be positive number"</text>
            </g>
            
            <!-- E2: Missing Required Fields -->
            <g transform="translate(350, 1230)">
                <rect x="0" y="0" width="280" height="50" fill="#ffebee" stroke="#f44336" rx="3"/>
                <text x="140" y="20" text-anchor="middle" font-size="11" font-weight="bold">E2: Missing Required Fields</text>
                <text x="140" y="35" text-anchor="middle" font-size="10">Name or category empty</text>
                <text x="140" y="50" text-anchor="middle" font-size="10">‚Üí "Required fields missing"</text>
            </g>
            
            <!-- E3: Duplicate Name Warning -->
            <g transform="translate(650, 1230)">
                <rect x="0" y="0" width="280" height="50" fill="#fff3e0" stroke="#ff9800" rx="3"/>
                <text x="140" y="20" text-anchor="middle" font-size="11" font-weight="bold">E3: Duplicate Name</text>
                <text x="140" y="35" text-anchor="middle" font-size="10">Same dish name exists</text>
                <text x="140" y="50" text-anchor="middle" font-size="10">‚Üí Warning: "Dish name exists, continue?"</text>
            </g>
            
            <!-- E4: Image Upload Failure -->
            <g transform="translate(950, 1230)">
                <rect x="0" y="0" width="250" height="50" fill="#ffebee" stroke="#f44336" rx="3"/>
                <text x="125" y="20" text-anchor="middle" font-size="11" font-weight="bold">E4: Image Upload Failed</text>
                <text x="125" y="35" text-anchor="middle" font-size="10">File too large or wrong format</text>
                <text x="125" y="50" text-anchor="middle" font-size="10">‚Üí Create without image</text>
            </g>
            
            <!-- Arrow definitions -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#333"/>
                </marker>
                <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#4caf50"/>
                </marker>
                <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#f44336"/>
                </marker>
            </defs>
        </svg>

        <h2>üíª Detailed Pseudocode</h2>
        <div class="pseudocode">
<span class="comment">// TrueBite Menu Management System - UC-09</span>

<span class="keyword">CLASS</span> <span class="function">MenuService</span>:
    
    <span class="keyword">FUNCTION</span> createDish(chefId: String, dishData: DishInput):
        <span class="keyword">INPUT</span>: {
            chefId: String,
            dishData: {
                name: String (required),
                description: String,
                price: Decimal (required),
                category: String (required),
                dietaryTags: List&lt;String&gt;,
                imageFile: File (optional),
                preparationTime: Integer,
                ingredients: List&lt;String&gt;
            }
        }
        
        <span class="comment">// Step 1: Validate input data</span>
        validationResult = ValidationService.validateDishData(dishData)
        
        <span class="keyword">IF NOT</span> validationResult.isValid:
            <span class="keyword">RETURN</span> Result(
                error: validationResult.errors,
                status: <span class="string">"VALIDATION_FAILED"</span>
            )
        
        <span class="comment">// Step 2: Check chef authorization</span>
        chef = UserRepository.findById(chefId)
        <span class="keyword">IF</span> chef == null OR chef.role != <span class="string">"CHEF"</span>:
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Unauthorized to manage menu"</span>)
        
        <span class="comment">// Step 3: Check for duplicate dish name (warning only)</span>
        existingDish = DishRepository.findByNameAndChef(dishData.name, chefId)
        
        <span class="keyword">IF</span> existingDish != null:
            <span class="comment">// Optional warning - can proceed</span>
            log.warn(<span class="string">"Duplicate dish name for chef: "</span> + chefId)
            warningMessage = <span class="string">"A dish with this name already exists"</span>
        
        <span class="comment">// Step 4: Upload image if provided</span>
        imageUrl = null
        <span class="keyword">IF</span> dishData.imageFile != null:
            <span class="keyword">TRY</span>:
                imageUrl = FileService.uploadDishImage(
                    file: dishData.imageFile,
                    chefId: chefId,
                    dishName: dishData.name
                )
            <span class="keyword">CATCH</span> FileUploadException e:
                <span class="comment">// Continue without image</span>
                log.error(<span class="string">"Image upload failed: "</span> + e.message)
                imageUrl = <span class="string">"/default/dish-placeholder.jpg"</span>
        
        <span class="comment">// Step 5: Create dish entity</span>
        dish = new Dish()
        dish.dishId = generateUUID()
        dish.name = dishData.name
        dish.description = dishData.description
        dish.price = dishData.price
        dish.category = dishData.category
        dish.chefId = chefId
        dish.imageUrl = imageUrl ?? <span class="string">"/default/dish-placeholder.jpg"</span>
        dish.isActive = true
        dish.isAvailable = true
        dish.createdAt = now()
        dish.updatedAt = now()
        dish.preparationTime = dishData.preparationTime ?? 30
        dish.popularity = 0
        
        <span class="comment">// Step 6: Save dietary tags</span>
        <span class="keyword">IF</span> dishData.dietaryTags != null:
            <span class="keyword">FOR EACH</span> tag <span class="keyword">IN</span> dishData.dietaryTags:
                dishTag = new DishDietaryTag()
                dishTag.dishId = dish.dishId
                dishTag.tag = tag.toLowerCase()
                DishTagRepository.save(dishTag)
        
        <span class="comment">// Step 7: Save dish to database</span>
        <span class="keyword">BEGIN TRANSACTION</span>:
            DishRepository.save(dish)
            
            <span class="comment">// Log menu change</span>
            menuLog = new MenuChangeLog()
            menuLog.chefId = chefId
            menuLog.dishId = dish.dishId
            menuLog.action = <span class="string">"CREATE"</span>
            menuLog.changes = <span class="string">"New dish added: "</span> + dish.name
            menuLog.timestamp = now()
            MenuLogRepository.save(menuLog)
            
            <span class="comment">// Clear menu cache</span>
            CacheService.clearMenuCache()
            
        <span class="keyword">COMMIT TRANSACTION</span>
        
        <span class="comment">// Step 8: Notify about new dish</span>
        NotificationService.notifyNewDish(dish)
        
        <span class="keyword">RETURN</span> Result(
            success: true,
            dishId: dish.dishId,
            message: <span class="string">"Dish created successfully"</span>,
            warning: warningMessage
        )
    
    <span class="keyword">FUNCTION</span> updateDish(chefId: String, dishId: String, updates: DishUpdate):
        <span class="keyword">INPUT</span>: {
            dishId: String,
            updates: {
                name: String (optional),
                description: String (optional),
                price: Decimal (optional),
                category: String (optional),
                status: String (optional), <span class="comment">// ACTIVE, UNAVAILABLE, DISCONTINUED</span>
                dietaryTags: List&lt;String&gt; (optional),
                imageFile: File (optional)
            }
        }
        
        <span class="comment">// Step 1: Fetch existing dish</span>
        dish = DishRepository.findById(dishId)
        
        <span class="keyword">IF</span> dish == null:
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Dish not found"</span>)
        
        <span class="comment">// Step 2: Verify chef ownership</span>
        <span class="keyword">IF</span> dish.chefId != chefId:
            <span class="keyword">RETURN</span> Result(error: <span class="string">"Not authorized to update this dish"</span>)
        
        <span class="comment">// Step 3: Validate updates</span>
        <span class="keyword">IF</span> updates.price != null:
            <span class="keyword">IF</span> updates.price <= 0:
                <span class="keyword">RETURN</span> Result(error: <span class="string">"Price must be positive"</span>)
        
        <span class="comment">// Step 4: Track changes for audit</span>
        changes = []
        oldValues = dish.clone()
        
        <span class="comment">// Step 5: Apply updates</span>
        <span class="keyword">IF</span> updates.name != null:
            dish.name = updates.name
            changes.add(<span class="string">"Name: "</span> + oldValues.name + <span class="string">" ‚Üí "</span> + updates.name)
        
        <span class="keyword">IF</span> updates.description != null:
            dish.description = updates.description
            changes.add(<span class="string">"Description updated"</span>)
        
        <span class="keyword">IF</span> updates.price != null:
            dish.price = updates.price
            changes.add(<span class="string">"Price: $"</span> + oldValues.price + <span class="string">" ‚Üí $"</span> + updates.price)
        
        <span class="keyword">IF</span> updates.category != null:
            dish.category = updates.category
            changes.add(<span class="string">"Category: "</span> + oldValues.category + <span class="string">" ‚Üí "</span> + updates.category)
        
        <span class="keyword">IF</span> updates.status != null:
            <span class="comment">// Special handling for status changes</span>
            <span class="keyword">IF</span> updates.status == <span class="string">"UNAVAILABLE"</span>:
                dish.isAvailable = false
                NotificationService.notifyDishUnavailable(dish)
            <span class="keyword">ELSE IF</span> updates.status == <span class="string">"DISCONTINUED"</span>:
                dish.isActive = false
                dish.isAvailable = false
            <span class="keyword">ELSE IF</span> updates.status == <span class="string">"ACTIVE"</span>:
                dish.isActive = true
                dish.isAvailable = true
            
            changes.add(<span class="string">"Status: "</span> + oldValues.status + <span class="string">" ‚Üí "</span> + updates.status)
        
        <span class="comment">// Step 6: Update image if provided</span>
        <span class="keyword">IF</span> updates.imageFile != null:
            <span class="keyword">TRY</span>:
                <span class="comment">// Delete old image if not default</span>
                <span class="keyword">IF NOT</span> dish.imageUrl.contains(<span class="string">"default"</span>):
                    FileService.deleteImage(dish.imageUrl)
                
                newImageUrl = FileService.uploadDishImage(
                    file: updates.imageFile,
                    chefId: chefId,
                    dishName: dish.name
                )
                dish.imageUrl = newImageUrl
                changes.add(<span class="string">"Image updated"</span>)
                
            <span class="keyword">CATCH</span> FileUploadException e:
                log.error(<span class="string">"Image update failed: "</span> + e.message)
        
        <span class="comment">// Step 7: Update dietary tags if provided</span>
        <span class="keyword">IF</span> updates.dietaryTags != null:
            <span class="comment">// Remove old tags</span>
            DishTagRepository.deleteByDishId(dishId)
            
            <span class="comment">// Add new tags</span>
            <span class="keyword">FOR EACH</span> tag <span class="keyword">IN</span> updates.dietaryTags:
                dishTag = new DishDietaryTag()
                dishTag.dishId = dishId
                dishTag.tag = tag.toLowerCase()
                DishTagRepository.save(dishTag)
            
            changes.add(<span class="string">"Dietary tags updated"</span>)
        
        dish.updatedAt = now()
        
        <span class="comment">// Step 8: Save changes</span>
        <span class="keyword">BEGIN TRANSACTION</span>:
            DishRepository.update(dish)
            
            <span class="comment">// Log changes</span>
            menuLog = new MenuChangeLog()
            menuLog.chefId = chefId
            menuLog.dishId = dishId
            menuLog.action = <span class="string">"UPDATE"</span>
            menuLog.changes = changes.join(<span class="string">"; "</span>)
            menuLog.timestamp = now()
            MenuLogRepository.save(menuLog)
            
            <span class="comment">// Clear cache</span>
            CacheService.clearMenuCache()
            CacheService.clearDishCache(dishId)
            
        <span class="keyword">COMMIT TRANSACTION</span>
        
        <span class="keyword">RETURN</span> Result(
            success: true,
            message: <span class="string">"Dish updated successfully"</span>,
            changes: changes
        )

<span class="keyword">CLASS</span> <span class="function">ValidationService</span>:
    
    <span class="keyword">FUNCTION</span> validateDishData(dishData: DishInput):
        errors = []
        
        <span class="comment">// Required field validation</span>
        <span class="keyword">IF</span> dishData.name == null OR dishData.name.trim().isEmpty():
            errors.add(<span class="string">"Dish name is required"</span>)
        <span class="keyword">ELSE IF</span> dishData.name.length() > 100:
            errors.add(<span class="string">"Dish name too long (max 100 characters)"</span>)
        
        <span class="keyword">IF</span> dishData.price == null:
            errors.add(<span class="string">"Price is required"</span>)
        <span class="keyword">ELSE IF</span> dishData.price <= 0:
            errors.add(<span class="string">"Price must be positive"</span>)
        <span class="keyword">ELSE IF</span> dishData.price > 999.99:
            errors.add(<span class="string">"Price exceeds maximum ($999.99)"</span>)
        
        <span class="keyword">IF</span> dishData.category == null OR dishData.category.isEmpty():
            errors.add(<span class="string">"Category is required"</span>)
        <span class="keyword">ELSE IF NOT</span> isValidCategory(dishData.category):
            errors.add(<span class="string">"Invalid category. Must be: Appetizers, Main Courses, Desserts, or Beverages"</span>)
        
        <span class="comment">// Optional field validation</span>
        <span class="keyword">IF</span> dishData.description != null AND dishData.description.length() > 500:
            errors.add(<span class="string">"Description too long (max 500 characters)"</span>)
        
        <span class="keyword">IF</span> dishData.preparationTime != null:
            <span class="keyword">IF</span> dishData.preparationTime < 1 OR dishData.preparationTime > 180:
                errors.add(<span class="string">"Preparation time must be between 1 and 180 minutes"</span>)
        
        <span class="comment">// Image validation</span>
        <span class="keyword">IF</span> dishData.imageFile != null:
            <span class="keyword">IF</span> dishData.imageFile.size > MAX_IMAGE_SIZE: <span class="comment">// 5MB</span>
                errors.add(<span class="string">"Image file too large (max 5MB)"</span>)
            
            allowedTypes = [<span class="string">"image/jpeg"</span>, <span class="string">"image/png"</span>, <span class="string">"image/webp"</span>]
            <span class="keyword">IF NOT</span> allowedTypes.contains(dishData.imageFile.mimeType):
                errors.add(<span class="string">"Invalid image format. Use JPG, PNG, or WebP"</span>)
        
        <span class="comment">// Dietary tags validation</span>
        <span class="keyword">IF</span> dishData.dietaryTags != null:
            validTags = [<span class="string">"vegetarian"</span>, <span class="string">"vegan"</span>, <span class="string">"gluten-free"</span>, 
                        <span class="string">"dairy-free"</span>, <span class="string">"nut-free"</span>, <span class="string">"halal"</span>, <span class="string">"kosher"</span>]
            
            <span class="keyword">FOR EACH</span> tag <span class="keyword">IN</span> dishData.dietaryTags:
                <span class="keyword">IF NOT</span> validTags.contains(tag.toLowerCase()):
                    errors.add(<span class="string">"Invalid dietary tag: "</span> + tag)
        
        <span class="keyword">RETURN</span> ValidationResult(
            isValid: errors.isEmpty(),
            errors: errors
        )

<span class="keyword">CLASS</span> <span class="function">FileService</span>:
    
    <span class="keyword">FUNCTION</span> uploadDishImage(file: File, chefId: String, dishName: String):
        <span class="comment">// Generate unique filename</span>
        timestamp = now().toEpochMillis()
        sanitizedName = sanitizeFilename(dishName)
        extension = getFileExtension(file.name)
        filename = chefId + <span class="string">"/"</span> + sanitizedName + <span class="string">"_"</span> + timestamp + extension
        
        <span class="comment">// Resize image for web</span>
        resizedImage = ImageProcessor.resize(
            file: file,
            maxWidth: 800,
            maxHeight: 600,
            quality: 85
        )
        
        <span class="comment">// Create thumbnail</span>
        thumbnail = ImageProcessor.resize(
            file: file,
            maxWidth: 200,
            maxHeight: 150,
            quality: 80
        )
        
        <span class="comment">// Upload to S3</span>
        s3Client = new S3Client()
        mainUrl = s3Client.upload(
            bucket: <span class="string">"truebite-dishes"</span>,
            key: <span class="string">"images/"</span> + filename,
            file: resizedImage
        )
        
        thumbUrl = s3Client.upload(
            bucket: <span class="string">"truebite-dishes"</span>,
            key: <span class="string">"thumbnails/"</span> + filename,
            file: thumbnail
        )
        
        <span class="keyword">RETURN</span> mainUrl
</div>

        <h2>üìã Data Structures</h2>
        <table>
            <tr>
                <th>Entity</th>
                <th>Fields</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><strong>Dish</strong></td>
                <td>dishId, name, description, price, category, chefId, imageUrl, isActive, isAvailable, createdAt, updatedAt</td>
                <td>Menu item representation</td>
            </tr>
            <tr>
                <td><strong>DishInput</strong></td>
                <td>name, description, price, category, dietaryTags[], imageFile, preparationTime, ingredients[]</td>
                <td>Input DTO for dish creation</td>
            </tr>
            <tr>
                <td><strong>DishUpdate</strong></td>
                <td>name, description, price, category, status, dietaryTags[], imageFile</td>
                <td>Input DTO for dish updates</td>
            </tr>
            <tr>
                <td><strong>MenuChangeLog</strong></td>
                <td>logId, chefId, dishId, action, changes, timestamp</td>
                <td>Audit trail for menu changes</td>
            </tr>
            <tr>
                <td><strong>DishDietaryTag</strong></td>
                <td>dishId, tag</td>
                <td>Dietary restriction tags</td>
            </tr>
        </table>

        <h2>üóÑÔ∏è Database Schema</h2>
        <div class="pseudocode">
<span class="comment">-- Dishes table</span>
<span class="keyword">CREATE TABLE</span> dishes (
    dish_id <span class="keyword">UUID PRIMARY KEY DEFAULT</span> uuid_generate_v4(),
    chef_id <span class="keyword">INTEGER REFERENCES</span> users(user_id),
    name <span class="keyword">VARCHAR</span>(100) <span class="keyword">NOT NULL</span>,
    description <span class="keyword">TEXT</span>,
    price <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL CHECK</span> (price > 0),
    category <span class="keyword">VARCHAR</span>(50) <span class="keyword">NOT NULL</span>,
    image_url <span class="keyword">VARCHAR</span>(255),
    is_active <span class="keyword">BOOLEAN DEFAULT</span> true,
    is_available <span class="keyword">BOOLEAN DEFAULT</span> true,
    preparation_time <span class="keyword">INTEGER DEFAULT</span> 30,
    popularity <span class="keyword">INTEGER DEFAULT</span> 0,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    updated_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
);

<span class="comment">-- Dietary tags table</span>
<span class="keyword">CREATE TABLE</span> dish_dietary_tags (
    dish_id <span class="keyword">UUID REFERENCES</span> dishes(dish_id) <span class="keyword">ON DELETE CASCADE</span>,
    tag <span class="keyword">VARCHAR</span>(50) <span class="keyword">NOT NULL</span>,
    <span class="keyword">PRIMARY KEY</span> (dish_id, tag)
);

<span class="comment">-- Menu change log table</span>
<span class="keyword">CREATE TABLE</span> menu_change_logs (
    log_id <span class="keyword">UUID PRIMARY KEY DEFAULT</span> uuid_generate_v4(),
    chef_id <span class="keyword">INTEGER REFERENCES</span> users(user_id),
    dish_id <span class="keyword">UUID REFERENCES</span> dishes(dish_id),
    action <span class="keyword">VARCHAR</span>(20) <span class="keyword">NOT NULL</span>, <span class="comment">-- CREATE, UPDATE, DELETE</span>
    changes <span class="keyword">TEXT</span>,
    timestamp <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
);

<span class="comment">-- Indexes for performance</span>
<span class="keyword">CREATE INDEX</span> idx_dishes_chef <span class="keyword">ON</span> dishes(chef_id);
<span class="keyword">CREATE INDEX</span> idx_dishes_category <span class="keyword">ON</span> dishes(category);
<span class="keyword">CREATE INDEX</span> idx_dishes_active <span class="keyword">ON</span> dishes(is_active, is_available);
<span class="keyword">CREATE INDEX</span> idx_dishes_name <span class="keyword">ON</span> dishes(name);
<span class="keyword">CREATE INDEX</span> idx_tags_dish <span class="keyword">ON</span> dish_dietary_tags(dish_id);
</div>

        <h2>‚úÖ Validation Rules</h2>
        <div class="info-box">
            <strong>Required Fields:</strong><br>
            ‚Ä¢ Name: 1-100 characters, non-empty<br>
            ‚Ä¢ Price: Positive decimal, max $999.99<br>
            ‚Ä¢ Category: Must be valid category<br><br>
            
            <strong>Optional Fields:</strong><br>
            ‚Ä¢ Description: Max 500 characters<br>
            ‚Ä¢ Image: JPG/PNG/WebP, max 5MB<br>
            ‚Ä¢ Preparation time: 1-180 minutes<br>
            ‚Ä¢ Dietary tags: From predefined list<br><br>
            
            <strong>Business Rules:</strong><br>
            ‚Ä¢ Duplicate names: Warning only (allowed)<br>
            ‚Ä¢ Status changes: Log all modifications<br>
            ‚Ä¢ Cache invalidation on any change<br>
            ‚Ä¢ Image optimization before storage
        </div>

        <h2>üß™ Test Cases</h2>
        <div class="success-flow">
            <strong>Test 1: Create New Dish</strong><br>
            ‚Ä¢ Input: Valid dish data with image<br>
            ‚Ä¢ Expected: Dish created with ID<br>
            ‚Ä¢ Image uploaded and resized<br>
            ‚Ä¢ Cache cleared<br>
            ‚Ä¢ Log entry created
        </div>

        <div class="error-flow">
            <strong>Test 2: Invalid Price</strong><br>
            ‚Ä¢ Input: Price = -10 or 0<br>
            ‚Ä¢ Expected: Validation error<br>
            ‚Ä¢ No dish created<br>
            ‚Ä¢ Error: "Price must be positive"
        </div>

        <div class="normal-flow">
            <strong>Test 3: Update Dish Status</strong><br>
            ‚Ä¢ Change status to UNAVAILABLE<br>
            ‚Ä¢ Expected: Dish marked unavailable<br>
            ‚Ä¢ Customer notifications sent<br>
            ‚Ä¢ Change logged with timestamp
        </div>

        <div class="error-flow">
            <strong>Test 4: Duplicate Name Warning</strong><br>
            ‚Ä¢ Create dish with existing name<br>
            ‚Ä¢ Expected: Warning message shown<br>
            ‚Ä¢ Chef can proceed if desired<br>
            ‚Ä¢ Both dishes exist with same name
        </div>
    </div>
</body>
</html>
